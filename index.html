<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>رعد | المنصة الإسلامية الذكية</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@400;700;900&family=Amiri:wght@400;700&display=swap" rel="stylesheet">
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
        :root { --primary: #f59e0b; --bg-dark: #020617; }
        body { font-family: 'Tajawal', sans-serif; background-color: var(--bg-dark); color: #e2e8f0; overflow-x: hidden; scroll-behavior: smooth; }
        .fire-gradient { background: radial-gradient(circle at 50% -20%, #450a0a, #020617 70%); }
        .tab-content { display: none; opacity: 0; transform: translateY(15px); transition: all 0.4s ease; }
        .tab-content.active { display: block; opacity: 1; transform: translateY(0); }
        .quran-text { line-height: 2.8; font-family: 'Amiri', serif; }
        .glass { background: rgba(15, 23, 42, 0.6); backdrop-filter: blur(12px); border: 1px solid rgba(255, 255, 255, 0.05); }
        .nav-active { color: var(--primary) !important; filter: drop-shadow(0 0 8px rgba(245, 158, 11, 0.5)); }
        .tasbih-btn:active { transform: scale(0.92); }
        .counter-glow { text-shadow: 0 0 30px rgba(245, 158, 11, 0.6); }
        @keyframes pulse-slow { 0%, 100% { opacity: 0.3; } 50% { opacity: 0.6; } }
        .bg-glow { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: radial-gradient(circle at 50% 50%, #f59e0b10 0%, transparent 50%); pointer-events: none; z-index: -1; animation: pulse-slow 8s infinite; }
    </style>
</head>
<body class="pb-24 md:pb-0 md:pr-24 fire-gradient">
    <div class="bg-glow"></div>

    <nav class="fixed bottom-0 left-0 right-0 glass border-t border-white/5 flex justify-around p-4 z-50 md:top-0 md:right-0 md:left-auto md:flex-col md:w-24 md:h-screen md:border-l md:border-t-0 md:justify-center md:gap-8">
        <button onclick="showTab('home')" class="nav-btn flex flex-col items-center gap-1 nav-active" data-tab="home"><i data-lucide="home"></i></button>
        <button onclick="showTab('quran')" class="nav-btn flex flex-col items-center gap-1 text-slate-500" data-tab="quran"><i data-lucide="book"></i></button>
        <button onclick="showTab('tasbih')" class="nav-btn flex flex-col items-center gap-1 text-slate-500" data-tab="tasbih"><i data-lucide="refresh-cw"></i></button>
        <button onclick="showTab('azkar')" class="nav-btn flex flex-col items-center gap-1 text-slate-500" data-tab="azkar"><i data-lucide="sun"></i></button>
        <button onclick="showTab('heart')" class="nav-btn flex flex-col items-center gap-1 text-slate-500" data-tab="heart"><i data-lucide="heart"></i></button>
        <button onclick="showTab('settings')" class="nav-btn flex flex-col items-center gap-1 text-slate-500" data-tab="settings"><i data-lucide="settings"></i></button>
    </nav>

    <main class="max-w-4xl mx-auto p-6 md:p-12 relative">
        <header class="flex justify-between items-center mb-12">
            <div class="flex items-center gap-4">
                <div class="p-3 bg-amber-500 shadow-[0_0_20px_rgba(245,158,11,0.4)] rounded-2xl"><i data-lucide="shield-check" class="text-slate-950 w-8 h-8"></i></div>
                <h1 class="text-4xl font-black text-white tracking-tighter">رعد <span class="text-amber-500 text-sm font-bold block uppercase tracking-widest">مساعد إيماني ذكي</span></h1>
            </div>
            <button onclick="toggleAiDrawer()" class="p-4 bg-slate-900/50 hover:bg-amber-500 hover:text-slate-950 rounded-2xl border border-white/5 transition-colors"><i data-lucide="bot"></i></button>
        </header>

        <section id="home" class="tab-content active space-y-8">
            <div class="relative overflow-hidden bg-gradient-to-br from-amber-500 to-orange-600 p-8 rounded-[2.5rem] shadow-2xl">
                <div class="relative z-10">
                    <h2 class="text-3xl font-black text-slate-950 mb-2">مرحباً بك في رعد</h2>
                    <p class="text-slate-900 font-medium opacity-80">منصتك الإسلامية الذكية</p>
                </div>
                <i data-lucide="moon" class="absolute -right-4 -top-4 w-32 h-32 text-white/10 rotate-12"></i>
            </div>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                <div onclick="showTab('quran')" class="glass p-8 rounded-[2.5rem] cursor-pointer hover:border-amber-500/50 transition-all group">
                    <div class="w-12 h-12 bg-amber-500/10 rounded-xl flex items-center justify-center mb-4 group-hover:bg-amber-500"><i data-lucide="book-open" class="text-amber-500 group-hover:text-slate-950"></i></div>
                    <h3 class="text-xl font-bold">القرآن الكريم</h3>
                </div>
                <div onclick="toggleAiDrawer()" class="glass p-8 rounded-[2.5rem] cursor-pointer hover:border-blue-500/50 transition-all group border-blue-500/10">
                    <div class="w-12 h-12 bg-blue-500/10 rounded-xl flex items-center justify-center mb-4 group-hover:bg-blue-500"><i data-lucide="sparkles" class="text-blue-500 group-hover:text-slate-950"></i></div>
                    <h3 class="text-xl font-bold">رعد AI</h3>
                </div>
            </div>
        </section>

        <section id="quran" class="tab-content space-y-6">
            <div id="quran-header" class="flex flex-col md:flex-row gap-4 items-center justify-between mb-8">
                <h2 class="text-2xl font-black">المصحف الشريف</h2>
                <input type="text" id="surah-search" oninput="filterSurahs()" placeholder="ابحث عن سورة..." class="bg-white/5 border border-white/10 p-3 rounded-xl outline-none focus:border-amber-500 w-full md:w-64 text-sm">
            </div>
            <div id="surah-list" class="grid grid-cols-2 sm:grid-cols-3 gap-4"></div>
            <div id="surah-reader" class="hidden bg-white text-slate-900 p-8 rounded-[3rem] text-right shadow-2xl relative">
                <button onclick="backToSurahList()" class="text-amber-700 font-bold mb-8 flex items-center gap-2"><i data-lucide="arrow-right"></i> الفهرس</button>
                <h3 id="surah-title" class="text-center text-4xl font-black mb-12 font-serif text-amber-900"></h3>
                <div id="surah-content" class="text-2xl quran-text text-justify px-2"></div>
            </div>
        </section>

        <section id="tasbih" class="tab-content py-10">
            <div class="max-w-md mx-auto glass p-10 rounded-[3rem] text-center">
                <div id="tasbih-label" class="text-amber-500 font-bold mb-4 tracking-widest uppercase">سُبْحَانَ اللَّهِ</div>
                <div id="tasbih-counter" class="text-9xl font-black counter-glow mb-10">0</div>
                <button onclick="incrementTasbih()" class="tasbih-btn w-48 h-48 bg-amber-500 rounded-full mx-auto flex items-center justify-center shadow-lg active:scale-90 transition-transform">
                    <i data-lucide="plus" class="w-16 h-16 text-slate-950"></i>
                </button>
                <div class="flex gap-4 mt-12">
                    <button onclick="resetTasbih()" class="flex-1 py-4 glass rounded-2xl font-bold">تصفير</button>
                    <select id="tasbih-type" onchange="changeTasbihType()" class="flex-[2] py-4 glass rounded-2xl bg-transparent px-4 outline-none border-none text-white">
                        <option value="سُبْحَانَ اللَّهِ" class="bg-slate-900">سُبْحَانَ اللَّهِ</option>
                        <option value="الْحَمْدُ لِلَّهِ" class="bg-slate-900">الْحَمْدُ لِلَّهِ</option>
                        <option value="اللَّهُ أَكْبَرُ" class="bg-slate-900">اللَّهُ أَكْبَرُ</option>
                    </select>
                </div>
            </div>
        </section>

        <section id="azkar" class="tab-content space-y-6">
            <div class="flex gap-3 mb-8">
                <button onclick="fetchAzkar('أذكار الصباح')" class="px-8 py-3 bg-amber-500 text-slate-950 rounded-2xl font-bold">الصباح</button>
                <button onclick="fetchAzkar('أذكار المساء')" class="px-8 py-3 glass rounded-2xl font-bold">المساء</button>
            </div>
            <div id="azkar-container" class="space-y-4"></div>
        </section>

        <section id="settings" class="tab-content space-y-8">
            <h2 class="text-3xl font-black">الإعدادات</h2>
            <div class="glass p-10 rounded-[3rem] space-y-8">
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div><label class="text-xs font-bold text-slate-500 uppercase">Telegram Token</label><input type="password" id="input-token" class="w-full bg-black/40 border border-white/10 p-4 rounded-2xl outline-none focus:border-amber-500 mt-2"></div>
                    <div><label class="text-xs font-bold text-slate-500 uppercase">Chat ID</label><input type="text" id="input-chatid" class="w-full bg-black/40 border border-white/10 p-4 rounded-2xl outline-none focus:border-amber-500 mt-2"></div>
                </div>
                <button onclick="saveSettings()" class="w-full bg-white text-slate-950 py-5 rounded-2xl font-black">حفظ البيانات</button>
            </div>
        </section>
    </main>

    <div id="ai-drawer" class="fixed inset-y-0 left-0 w-full md:w-[450px] glass border-r border-white/10 z-[100] translate-x-full transition-transform duration-500 flex flex-col shadow-2xl">
        <div class="p-6 border-b border-white/5 flex justify-between items-center bg-slate-900/50">
            <span class="font-black text-xl">رعد AI</span>
            <button onclick="toggleAiDrawer()"><i data-lucide="x"></i></button>
        </div>
        <div id="ai-chat" class="flex-1 overflow-y-auto p-6 space-y-6 flex flex-col"></div>
        <div class="p-6 bg-slate-900/50 border-t border-white/5">
            <div class="relative flex items-center gap-2">
                <input type="text" id="ai-input" onkeypress="if(event.key === 'Enter') askAi()" placeholder="اسأل رعد..." class="w-full bg-black/40 border border-white/10 p-4 rounded-2xl outline-none focus:border-amber-500">
                <button onclick="askAi()" class="absolute left-2 p-2 bg-amber-500 text-slate-950 rounded-xl"><i data-lucide="send"></i></button>
            </div>
        </div>
    </div>

    <script>
        const apiKey = "AIzaSyBrW1NoWqgt3Edv6AtlvWb3ZEBOotld18Q"; //
        let allSurahs = [];
        let tasbihCount = parseInt(localStorage.getItem('tasbih_count')) || 0;

        document.addEventListener('DOMContentLoaded', () => {
            lucide.createIcons();
            loadQuranIndex();
            updateTasbihDisplay();
        });

        function showTab(tabId) {
            document.querySelectorAll('.tab-content').forEach(el => el.classList.remove('active'));
            document.getElementById(tabId).classList.add('active');
            document.querySelectorAll('.nav-btn').forEach(btn => {
                btn.classList.remove('nav-active');
                if(btn.dataset.tab === tabId) btn.classList.add('nav-active');
            });
            lucide.createIcons();
        }

        async function loadQuranIndex() {
            try {
                const res = await fetch('https://api.alquran.cloud/v1/surah');
                const data = await res.json();
                allSurahs = data.data;
                renderSurahList(allSurahs);
            } catch (e) { console.error("Error loading Quran index", e); }
        }

        function renderSurahList(list) {
            const container = document.getElementById('surah-list');
            container.innerHTML = list.map(s => `
                <button onclick="readSurah(${s.number}, '${s.name}')" class="glass p-5 rounded-3xl border-white/5 hover:border-amber-500 transition-all text-center">
                    <div class="font-black text-lg">${s.name}</div>
                </button>
            `).join('');
        }

        async function readSurah(num, name) {
            document.getElementById('quran-header').classList.add('hidden');
            document.getElementById('surah-list').classList.add('hidden');
            const reader = document.getElementById('surah-reader');
            const content = document.getElementById('surah-content');
            reader.classList.remove('hidden');
            document.getElementById('surah-title').innerText = `سورة ${name}`;
            content.innerText = "جاري التحميل...";
            try {
                const res = await fetch(`https://api.alquran.cloud/v1/surah/${num}/quran-uthmani`);
                const data = await res.json();
                content.innerHTML = data.data.ayahs.map(a => `${a.text} <span>(${a.numberInSurah})</span>`).join(' ');
            } catch (e) { content.innerText = "تعذر تحميل السورة."; }
        }

        function backToSurahList() {
            document.getElementById('quran-header').classList.remove('hidden');
            document.getElementById('surah-list').classList.remove('hidden');
            document.getElementById('surah-reader').classList.add('hidden');
        }

        async function fetchAzkar(category) {
            const container = document.getElementById('azkar-container');
            container.innerHTML = "جاري التحميل...";
            try {
                const res = await fetch('https://raw.githubusercontent.com/nawafalqari/azkar-api/56df51279ab6eb86dc359620c7de2198fef59620/azkar.json');
                const data = await res.json();
                container.innerHTML = (data[category] || []).map(item => `
                    <div class="glass p-6 rounded-3xl border-white/5 text-right">
                        <p class="text-xl font-serif">${item.zekr}</p>
                        <span class="text-amber-500 text-sm">التكرار: ${item.count}</span>
                    </div>
                `).join('');
            } catch (e) { container.innerHTML = "خطأ في جلب الأذكار."; }
        }

        function incrementTasbih() { tasbihCount++; updateTasbihDisplay(); if(window.navigator.vibrate) window.navigator.vibrate(40); }
        function resetTasbih() { tasbihCount = 0; updateTasbihDisplay(); }
        function updateTasbihDisplay() { document.getElementById('tasbih-counter').innerText = tasbihCount; localStorage.setItem('tasbih_count', tasbihCount); }
        function changeTasbihType() { document.getElementById('tasbih-label').innerText = document.getElementById('tasbih-type').value; }
        function toggleAiDrawer() { const dr = document.getElementById('ai-drawer'); dr.classList.toggle('translate-x-full'); dr.classList.toggle('translate-x-0'); }

        async function askAi() {
            const input = document.getElementById('ai-input');
            const chat = document.getElementById('ai-chat');
            const prompt = input.value.trim();
            if(!prompt) return;
            chat.innerHTML += `<div class="self-end bg-amber-500 text-slate-950 p-4 rounded-2xl text-sm font-bold max-w-[80%]">${prompt}</div>`;
            input.value = '';
            try {
                const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-1.5-flash:generateContent?key=${apiKey}`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ contents: [{ parts: [{ text: "أجب باختصار وأدب كخبير شرعي: " + prompt }] }] })
                });
                const result = await response.json();
                const aiRes = result.candidates[0].content.parts[0].text;
                chat.innerHTML += `<div class="self-start bg-white/5 p-4 rounded-2xl text-sm border border-white/5 max-w-[85%] text-right">${aiRes}</div>`;
                chat.scrollTo(0, chat.scrollHeight);
            } catch (e) { chat.innerHTML += `<div class="text-rose-500 text-xs">خطأ في الاتصال.</div>`; }
        }

        function saveSettings() {
            localStorage.setItem('raad_tg_token', document.getElementById('input-token').value);
            localStorage.setItem('raad_tg_chat_id', document.getElementById('input-chatid').value);
            alert('تم الحفظ ✅');
        }
    </script>
</body>
</html>
       try {
                const res = await fetch('https://api.alquran.cloud/v1/surah');
                const data = await res.json();
                allSurahs = data.data;
                renderSurahList(allSurahs);
            } catch (e) { console.error(e); }
        }

        function renderSurahList(list) {
            const container = document.getElementById('surah-list');
            container.innerHTML = list.map(s => `
                <button onclick="readSurah(${s.number}, '${s.name}')" class="glass p-5 rounded-3xl border-white/5 hover:border-amber-500/50 transition-all text-center">
                    <div class="font-black text-lg text-white">${s.name}</div>
                    <div class="text-slate-500 text-[10px] mt-1">${s.numberOfAyahs} آية</div>
                </button>
            `).join('');
        }

        function filterSurahs() {
            const term = document.getElementById('surah-search').value.toLowerCase();
            const filtered = allSurahs.filter(s => s.name.toLowerCase().includes(term));
            renderSurahList(filtered);
        }

        async function readSurah(num, name) {
            window.scrollTo({ top: 0, behavior: 'smooth' });
            document.getElementById('quran-header').classList.add('hidden');
            document.getElementById('surah-list').classList.add('hidden');
            const reader = document.getElementById('surah-reader');
            const content = document.getElementById('surah-content');
            const title = document.getElementById('surah-title');
            reader.classList.remove('hidden');
            title.innerText = `سورة ${name}`;
            content.innerHTML = `<div class="text-center py-20"><i data-lucide="loader-2" class="animate-spin mx-auto text-amber-500 w-10 h-10"></i></div>`;
            lucide.createIcons();
            try {
                const res = await fetch(`https://api.alquran.cloud/v1/surah/${num}/quran-uthmani`);
                const data = await res.json();
                content.innerHTML = data.data.ayahs.map(a => `<span>${a.text} <span class="inline-flex items-center justify-center w-10 h-10 rounded-full border border-amber-200 text-amber-800 font-bold mx-2 text-sm font-sans">${a.numberInSurah}</span></span>`).join('');
            } catch (e) { content.innerText = "فشل التحميل."; }
        }

        function backToSurahList() {
            document.getElementById('quran-header').classList.remove('hidden');
            document.getElementById('surah-list').classList.remove('hidden');
            document.getElementById('surah-reader').classList.add('hidden');
        }

        // --- Azkar Logic ---
        async function fetchAzkar(category) {
            const container = document.getElementById('azkar-container');
            container.innerHTML = `<div class="text-center py-20"><i data-lucide="loader-2" class="animate-spin mx-auto text-amber-500 w-10 h-10"></i></div>`;
            lucide.createIcons();
            try {
                const res = await fetch('https://raw.githubusercontent.com/nawafalqari/azkar-api/56df51279ab6eb86dc359620c7de2198fef59620/azkar.json');
                const data = await res.json();
                const filtered = data[category] || [];
                container.innerHTML = filtered.map(item => `
                    <div onclick="decrementCount(this)" class="glass p-6 rounded-3xl border-white/5 cursor-pointer hover:border-amber-500/30 transition-all">
                        <div class="mb-4"><span class="bg-amber-500 text-slate-950 px-4 py-1 rounded-full font-black text-xs">الباقي: <span class="count-val">${item.count || 1}</span></span></div>
                        <p class="text-xl leading-relaxed text-right font-serif text-slate-100">${item.zekr}</p>
                    </div>
                `).join('');
                lucide.createIcons();
            } catch (e) { container.innerHTML = `<p class="text-rose-500 text-center">خطأ.</p>`; }
        }

        function decrementCount(card) {
            const valEl = card.querySelector('.count-val');
            let count = parseInt(valEl.innerText);
            if(count > 0) {
                count--;
                valEl.innerText = count;
                if(count === 0) card.style.opacity = "0.4";
            }
        }

        // --- UI Support ---
        function showTab(tabId) {
            document.querySelectorAll('.tab-content').forEach(el => el.classList.remove('active'));
            document.getElementById(tabId).classList.add('active');
            document.querySelectorAll('.nav-btn').forEach(btn => {
                btn.classList.remove('nav-active');
                if(btn.dataset.tab === tabId) btn.classList.add('nav-active');
            });
            lucide.createIcons();
        }

        function toggleAiDrawer() {
            const dr = document.getElementById('ai-drawer');
            dr.classList.toggle('translate-x-full');
            dr.classList.toggle('translate-x-0');
        }

        async function askAi() {
            const input = document.getElementById('ai-input');
            const chat = document.getElementById('ai-chat');
            const prompt = input.value.trim();
            if(!prompt) return;
            chat.innerHTML += `<div class="self-end bg-amber-500 text-slate-950 p-4 rounded-2xl text-sm font-bold">${prompt}</div>`;
            input.value = '';
            try {
                const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-09-2025:generateContent?key=${apiKey}`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ 
                        contents: [{ parts: [{ text: prompt }] }], 
                        systemInstruction: { parts: [{ text: "أنت مساعد إسلامي ذكي اسمك رعد. أجب بدقة شرعية وأسلوب مهذب." }] } 
                    })
                });
                const result = await response.json();
                const aiRes = result.candidates?.[0]?.content?.parts?.[0]?.text || "...";
                chat.innerHTML += `<div class="self-start bg-white/5 p-4 rounded-2xl text-sm border border-white/5">${aiRes}</div>`;
                chat.scrollTo(0, chat.scrollHeight);
            } catch (e) { chat.innerHTML += `<div class="text-rose-500">خطأ في الاتصال.</div>`; }
        }

        function saveSettings() {
            localStorage.setItem('raad_tg_token', document.getElementById('input-token').value);
            localStorage.setItem('raad_tg_chat_id', document.getElementById('input-chatid').value);
            alert('تم حفظ الإعدادات بنجاح ✅');
        }

        async function sendToTelegram() {
            const token = localStorage.getItem('raad_tg_token');
            const chatid = localStorage.getItem('raad_tg_chat_id');
            const msg = document.getElementById('tg-message').value;
            if(!token || !chatid || !msg.trim()) return;
            try {
                await fetch(`https://api.telegram.org/bot${token}/sendMessage`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ chat_id: chatid, text: `✨ *مناجاة من رعد* ✨\n\n${msg}` })
                });
                alert('تم الإرسال بنجاح ✅');
                document.getElementById('tg-message').value = '';
            } catch (e) { alert('تأكد من إعدادات التليجرام ❌'); }
        }
    </script>
</body>
</html>