<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>رعد ⚡ </title>
    
    <!-- Icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Amiri:wght@400;700&family=Reem+Kufi:wght@400;700&display=swap" rel="stylesheet">
    
    <!-- الخطوط القرآنية -->
    <link href="https://fonts.googleapis.com/css2?family=Lateef:wght@400;700&family=Noto+Naskh+Arabic:wght@400;700&display=swap" rel="stylesheet">
    
    <style>
        :root {
            --gold: #FFD700;
            --dark-gold: #b8860b;
            --bg: #0a0a0a;
            --card: #161616;
            --text: #FFD700;
            --light-text: #f8f9fa;
            --success: #28a745;
            --danger: #dc3545;
            --primary: #007bff;
            --challenge-blue: #3498db;
            --challenge-green: #2ecc71;
            --challenge-purple: #9b59b6;
            --theme-green: #2ecc71;
            --theme-blue: #3498db;
            --theme-purple: #9b59b6;
            --theme-red: #e74c3c;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Amiri', serif;
            background: var(--bg);
            color: var(--text);
            min-height: 100vh;
            padding-bottom: 80px;
            transition: all 0.3s ease;
        }
        
        .container {
            max-width: 900px;
            margin: 0 auto;
            padding: 15px;
        }
        
        h1 {
            text-align: center;
            font-family: 'Reem Kufi', sans-serif;
            font-size: 2.5rem;
            margin-bottom: 20px;
            color: var(--gold);
            text-shadow: 0 0 10px rgba(255, 215, 0, 0.3);
        }
        
        .subtitle {
            text-align: center;
            color: var(--light-text);
            margin-bottom: 20px;
            font-size: 1.2rem;
        }
        
        /* ========== شاشة التحميل ========== */
        #loadingScreen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: var(--bg);
            z-index: 10000;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            transition: opacity 0.5s ease;
        }
        
        .loading-content {
            text-align: center;
            padding: 20px;
            max-width: 500px;
        }
        
        .loading-ayah {
            font-size: 1.8rem;
            color: var(--gold);
            margin: 30px 0;
            line-height: 2;
            font-family: 'Lateef', serif;
        }
        
        .loading-reference {
            color: #aaa;
            margin-bottom: 30px;
            font-style: italic;
        }
        
        .loading-progress {
            width: 80%;
            height: 4px;
            background: #333;
            border-radius: 2px;
            overflow: hidden;
            margin: 20px auto;
        }
        
        .loading-progress-bar {
            height: 100%;
            background: var(--gold);
            width: 0%;
            transition: width 0.3s;
        }
        
        /* ========== التنقل المحسّن ========== */
        nav {
            display: grid;
            grid-template-columns: repeat(8, 1fr);
            gap: 8px;
            margin-bottom: 20px;
            background: var(--card);
            padding: 10px;
            border-radius: 15px;
            border: 1px solid var(--gold);
            transition: all 0.3s;
        }
        
        nav button {
            background: transparent;
            border: none;
            color: var(--text);
            padding: 12px 5px;
            border-radius: 8px;
            font-size: 0.9rem;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 5px;
        }
        
        nav button i {
            font-size: 1.2rem;
        }
        
        nav button:hover {
            background: rgba(255, 215, 0, 0.1);
            transform: translateY(-2px);
        }
        
        nav button.active {
            background: var(--gold);
            color: black;
            font-weight: bold;
            box-shadow: 0 4px 8px rgba(255, 215, 0, 0.2);
        }
        
        .quick-actions {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin-bottom: 15px;
            flex-wrap: wrap;
        }
        
        .quick-action-btn {
            background: var(--card);
            border: 1px solid var(--gold);
            color: var(--text);
            padding: 8px 15px;
            border-radius: 20px;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 0.9rem;
        }
        
        .quick-action-btn:hover {
            background: rgba(255, 215, 0, 0.1);
            transform: translateY(-1px);
        }
        
        /* ========== أقسام جديدة ========== */
        .section {
            display: none;
            animation: fadeIn 0.5s ease;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .active-section {
            display: block;
        }
        
        /* ========== صفحة القرآن المحسنة ========== */
        .quran-section {
            padding: 20px;
        }
        
        .quran-controls {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            flex-wrap: wrap;
            justify-content: center;
        }
        
        .quran-control-btn {
            background: var(--card);
            border: 1px solid var(--gold);
            color: var(--text);
            padding: 10px 15px;
            border-radius: 8px;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 8px;
            transition: all 0.3s;
        }
        
        .quran-control-btn:hover {
            background: rgba(255, 215, 0, 0.1);
        }
        
        .surahs-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(120px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }
        
        .surah-card {
            background: var(--card);
            border-radius: 12px;
            padding: 15px;
            text-align: center;
            border: 2px solid transparent;
            transition: all 0.3s;
            cursor: pointer;
            position: relative;
        }
        
        .surah-card:hover {
            border-color: var(--gold);
            transform: translateY(-5px);
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.2);
        }
        
        .surah-card.bookmarked::after {
            content: '⭐';
            position: absolute;
            top: 5px;
            left: 5px;
            font-size: 1rem;
        }
        
        .surah-card.read::after {
            content: '✓';
            position: absolute;
            top: 5px;
            right: 5px;
            color: var(--success);
            font-weight: bold;
        }
        
        .surah-number {
            background: var(--gold);
            color: black;
            width: 35px;
            height: 35px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 10px;
            font-weight: bold;
        }
        
        .surah-name {
            font-weight: bold;
            margin-bottom: 5px;
            font-size: 1.2rem;
        }
        
        .surah-info {
            color: #aaa;
            font-size: 0.9rem;
        }
        
        /* عرض الآيات المحسن */
        .ayahs-container {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: var(--bg);
            z-index: 1000;
            padding: 20px;
            overflow-y: auto;
            animation: slideUp 0.3s ease;
        }
        
        @keyframes slideUp {
            from { transform: translateY(100%); }
            to { transform: translateY(0); }
        }
        
        .ayahs-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 2px solid var(--gold);
        }
        
        .ayahs-controls {
            display: flex;
            gap: 10px;
        }
        
        .ayah-item {
            padding: 20px;
            border-bottom: 1px solid #333;
            font-size: 1.8rem;
            line-height: 2.5;
            text-align: right;
            font-family: 'Lateef', serif;
            transition: all 0.3s;
            position: relative;
        }
        
        .ayah-item:hover {
            background: rgba(255, 215, 0, 0.05);
        }
        
        .ayah-item.highlighted {
            background: rgba(255, 215, 0, 0.1);
            border-right: 3px solid var(--gold);
        }
        
        .ayah-number {
            display: inline-block;
            background: var(--gold);
            color: black;
            width: 35px;
            height: 35px;
            border-radius: 50%;
            text-align: center;
            line-height: 35px;
            margin-left: 15px;
            font-size: 1rem;
            font-family: 'Amiri', serif;
        }
        
        .ayah-actions {
            position: absolute;
            left: 10px;
            top: 10px;
            display: flex;
            gap: 5px;
            opacity: 0;
            transition: opacity 0.3s;
        }
        
        .ayah-item:hover .ayah-actions {
            opacity: 1;
        }
        
        .ayah-action-btn {
            background: rgba(0, 0, 0, 0.7);
            border: 1px solid var(--gold);
            color: var(--text);
            width: 35px;
            height: 35px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .ayah-action-btn:hover {
            background: var(--gold);
            color: black;
            transform: scale(1.1);
        }
        
        /* ========== المسبحة المحسنة ========== */
        .tasbih-section {
            padding: 20px;
            text-align: center;
        }
        
        .tasbih-presets {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin: 20px 0;
            flex-wrap: wrap;
        }
        
        .tasbih-preset {
            background: var(--card);
            border: 2px solid var(--gold);
            border-radius: 15px;
            padding: 15px;
            width: 150px;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .tasbih-preset:hover {
            background: rgba(255, 215, 0, 0.1);
            transform: translateY(-5px);
        }
        
        .tasbih-preset.active {
            background: var(--gold);
            color: black;
        }
        
        .counter-display {
            font-size: 8rem;
            font-weight: bold;
            color: var(--gold);
            margin: 30px 0;
            text-shadow: 0 0 20px rgba(255, 215, 0, 0.5);
            font-family: 'Reem Kufi';
            transition: all 0.3s;
        }
        
        .counter-display.celebrate {
            animation: celebrate 0.5s ease;
        }
        
        @keyframes celebrate {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.2); }
        }
        
        .tasbih-sound-btn {
            margin: 20px;
            padding: 10px 20px;
            background: var(--card);
            border: 2px solid var(--gold);
            color: var(--text);
            border-radius: 25px;
            cursor: pointer;
            display: inline-flex;
            align-items: center;
            gap: 10px;
            transition: all 0.3s;
        }
        
        .tasbih-sound-btn:hover {
            background: var(--gold);
            color: black;
        }
        
        .counter-buttons {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin: 40px 0;
            flex-wrap: wrap;
        }
        
        .counter-btn {
            background: var(--card);
            border: 3px solid var(--gold);
            color: var(--text);
            width: 80px;
            height: 80px;
            border-radius: 50%;
            font-size: 2rem;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s;
        }
        
        .counter-btn:hover {
            background: var(--gold);
            color: black;
            transform: scale(1.1);
        }
        
        .counter-btn.main {
            width: 100px;
            height: 100px;
            font-size: 2.5rem;
            background: var(--gold);
            color: black;
            box-shadow: 0 0 20px rgba(255, 215, 0, 0.5);
        }
        
        .tasbih-history {
            background: var(--card);
            border-radius: 15px;
            padding: 20px;
            margin-top: 40px;
            max-height: 200px;
            overflow-y: auto;
        }
        
        .history-item {
            display: flex;
            justify-content: space-between;
            padding: 10px;
            border-bottom: 1px solid #333;
        }
        
        /* ========== قسم الأدعية والأذكار الجديد ========== */
        .azkar-section {
            padding: 20px;
        }
        
        .azkar-tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            overflow-x: auto;
            padding: 10px 0;
        }
        
        .azkar-tab {
            background: var(--card);
            border: 2px solid transparent;
            color: var(--text);
            padding: 12px 20px;
            border-radius: 10px;
            cursor: pointer;
            white-space: nowrap;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .azkar-tab:hover {
            background: rgba(255, 215, 0, 0.1);
        }
        
        .azkar-tab.active {
            background: var(--gold);
            color: black;
            border-color: var(--gold);
            font-weight: bold;
        }
        
        .azkar-category {
            display: none;
        }
        
        .azkar-category.active {
            display: block;
        }
        
        .azkar-card {
            background: var(--card);
            border-radius: 20px;
            padding: 25px;
            margin-bottom: 20px;
            border: 2px solid var(--gold);
            position: relative;
        }
        
        .azkar-text {
            font-size: 1.6rem;
            line-height: 2;
            text-align: center;
            margin-bottom: 25px;
            color: var(--light-text);
            font-family: 'Amiri', serif;
        }
        
        .azkar-reference {
            text-align: left;
            color: #aaa;
            font-size: 1.1rem;
            margin-bottom: 20px;
            direction: ltr;
            text-align: right;
        }
        
        .azkar-benefits {
            background: rgba(255, 215, 0, 0.1);
            border-radius: 15px;
            padding: 15px;
            margin-top: 15px;
            color: #ddd;
            line-height: 1.8;
            font-size: 0.95rem;
        }
        
        .azkar-counter {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 15px;
            margin: 20px 0;
        }
        
        .azkar-count {
            font-size: 2.5rem;
            font-weight: bold;
            color: var(--gold);
            min-width: 60px;
            text-align: center;
        }
        
        .azkar-count-btn {
            background: var(--card);
            border: 2px solid var(--gold);
            color: var(--text);
            width: 50px;
            height: 50px;
            border-radius: 50%;
            font-size: 1.5rem;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .azkar-count-btn:hover {
            background: var(--gold);
            color: black;
        }
        
        .azkar-reminder {
            background: rgba(52, 152, 219, 0.1);
            border: 1px solid var(--theme-blue);
            border-radius: 10px;
            padding: 15px;
            margin-top: 20px;
            text-align: center;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }
        
        /* ========== التخصيص والسمات ========== */
        .theme-section {
            padding: 20px;
        }
        
        .theme-selector {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin: 30px 0;
        }
        
        .theme-card {
            background: var(--card);
            border: 2px solid transparent;
            border-radius: 15px;
            padding: 20px;
            cursor: pointer;
            transition: all 0.3s;
            text-align: center;
        }
        
        .theme-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.2);
        }
        
        .theme-card.active {
            border-color: var(--gold);
        }
        
        .theme-preview {
            width: 100%;
            height: 100px;
            border-radius: 10px;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2rem;
        }
        
        .font-selector {
            background: var(--card);
            border-radius: 15px;
            padding: 20px;
            margin: 30px 0;
        }
        
        .font-option {
            display: flex;
            align-items: center;
            gap: 15px;
            padding: 15px;
            margin-bottom: 10px;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .font-option:hover {
            background: rgba(255, 215, 0, 0.1);
        }
        
        .font-option.active {
            background: rgba(255, 215, 0, 0.2);
            border: 2px solid var(--gold);
        }
        
        .font-preview {
            font-size: 1.3rem;
            flex: 1;
        }
        
        .background-selector {
            background: var(--card);
            border-radius: 15px;
            padding: 20px;
            margin: 30px 0;
        }
        
        .background-options {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
            margin-top: 15px;
        }
        
        .background-option {
            height: 100px;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s;
            background-size: cover;
            background-position: center;
            position: relative;
            overflow: hidden;
        }
        
        .background-option:hover {
            transform: scale(1.05);
        }
        
        .background-option.active::after {
            content: '✓';
            position: absolute;
            top: 10px;
            right: 10px;
            background: var(--gold);
            color: black;
            width: 30px;
            height: 30px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
        }
        
        /* ========== التحديات ========== */
        .challenges-container {
            padding: 20px;
        }
        
        .stats-header {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 15px;
            margin-bottom: 25px;
        }
        
        .stat-card {
            background: linear-gradient(135deg, var(--card), #1a1a1a);
            border-radius: 15px;
            padding: 20px;
            text-align: center;
            border: 2px solid var(--gold);
            transition: transform 0.3s;
        }
        
        .stat-card:hover {
            transform: translateY(-5px);
        }
        
        .stat-icon {
            font-size: 2.5rem;
            color: var(--gold);
            margin-bottom: 10px;
        }
        
        .stat-value {
            font-size: 2.2rem;
            font-weight: bold;
            color: var(--text);
            font-family: 'Reem Kufi';
        }
        
        .stat-label {
            color: #aaa;
            font-size: 0.9rem;
            margin-top: 5px;
        }
        
        /* ========== الفوتر ========== */
        .footer-nav {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: var(--card);
            border-top: 2px solid var(--gold);
            padding: 10px;
            display: flex;
            justify-content: space-around;
            z-index: 1000;
        }
        
        .footer-btn {
            background: transparent;
            border: none;
            color: var(--text);
            padding: 10px;
            cursor: pointer;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 5px;
            font-size: 0.8rem;
            transition: all 0.3s;
        }
        
        .footer-btn:hover {
            color: var(--gold);
            transform: translateY(-2px);
        }
        
        .footer-btn.active {
            color: var(--gold);
            font-weight: bold;
        }
        
        /* ========== الأزرار العامة ========== */
        .btn {
            background: var(--gold);
            color: black;
            border: none;
            padding: 12px 25px;
            border-radius: 8px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }
        
        .btn:hover {
            background: #ffed4e;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(255, 215, 0, 0.3);
        }
        
        .btn-secondary {
            background: var(--card);
            color: var(--text);
            border: 1px solid var(--gold);
        }
        
        .btn-secondary:hover {
            background: rgba(255, 215, 0, 0.1);
        }
        
        /* ========== الخصوصية ========== */
        .hidden {
            display: none !important;
        }
        
        /* ========== الإشعارات ========== */
        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            background: var(--card);
            border: 2px solid var(--gold);
            border-radius: 10px;
            padding: 15px 25px;
            z-index: 10001;
            max-width: 300px;
            animation: slideIn 0.3s ease;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
        }
        
        @keyframes slideIn {
            from { transform: translateX(100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }
        
        @keyframes slideOut {
            from { transform: translateX(0); opacity: 1; }
            to { transform: translateX(100%); opacity: 0; }
        }
        
        /* ========== الاستجابة ========== */
        @media (max-width: 768px) {
            nav {
                grid-template-columns: repeat(4, 1fr);
            }
            
            .counter-display {
                font-size: 6rem;
            }
            
            .counter-btn {
                width: 70px;
                height: 70px;
                font-size: 1.8rem;
            }
            
            .counter-btn.main {
                width: 85px;
                height: 85px;
            }
            
            .stats-header {
                grid-template-columns: repeat(3, 1fr);
            }
            
            .azkar-text {
                font-size: 1.4rem;
            }
            
            .ayah-item {
                font-size: 1.5rem;
            }
        }
        
        @media (max-width: 480px) {
            nav {
                grid-template-columns: repeat(3, 1fr);
                gap: 5px;
            }
            
            nav button {
                padding: 8px 2px;
                font-size: 0.8rem;
            }
            
            nav button i {
                font-size: 1rem;
            }
            
            .counter-display {
                font-size: 5rem;
            }
            
            .counter-buttons {
                gap: 10px;
            }
            
            .counter-btn {
                width: 60px;
                height: 60px;
                font-size: 1.5rem;
            }
            
            .counter-btn.main {
                width: 70px;
                height: 70px;
                font-size: 2rem;
            }
            
            .surahs-grid {
                grid-template-columns: repeat(auto-fill, minmax(100px, 1fr));
            }
            
            .theme-selector {
                grid-template-columns: 1fr;
            }
        }
        
        /* ========== السمات المخصصة ========== */
        /* الذهبية (الافتراضية) */
        .theme-gold {
            --gold: #FFD700;
            --dark-gold: #b8860b;
            --bg: #0a0a0a;
            --card: #161616;
            --text: #FFD700;
        }
        
        /* الخضراء */
        .theme-green {
            --gold: #2ecc71;
            --dark-gold: #27ae60;
            --bg: #0a140a;
            --card: #162016;
            --text: #2ecc71;
        }
        
        /* الزرقاء */
        .theme-blue {
            --gold: #3498db;
            --dark-gold: #2980b9;
            --bg: #0a0a14;
            --card: #161620;
            --text: #3498db;
        }
        
        /* الأرجوانية */
        .theme-purple {
            --gold: #9b59b6;
            --dark-gold: #8e44ad;
            --bg: #140a14;
            --card: #201620;
            --text: #9b59b6;
        }
        
        /* الحمراء */
        .theme-red {
            --gold: #e74c3c;
            --dark-gold: #c0392b;
            --bg: #140a0a;
            --card: #201616;
            --text: #e74c3c;
        }
        
        /* الوضع الفاتح */
        .theme-light {
            --gold: #b8860b;
            --dark-gold: #8b6914;
            --bg: #f5f5f5;
            --card: #ffffff;
            --text: #333333;
            --light-text: #555555;
        }
    </style>
</head>
<body class="theme-gold">
    <!-- شاشة التحميل -->
    <div id="loadingScreen">
        <div class="loading-content">
            <div style="font-size: 4rem; color: var(--gold); margin-bottom: 20px; animation: pulse 1.5s infinite;">
                <i class="fas fa-mosque"></i>
            </div>
            <h1 style="color: var(--gold); margin-bottom: 20px; font-family: 'Reem Kufi';">رعد</h1>
            
            <div class="loading-ayah" id="loadingAyah"></div>
            <div class="loading-reference" id="loadingReference"></div>
            
            <div class="loading-progress">
                <div class="loading-progress-bar" id="loadingProgress"></div>
            </div>
            
            <p style="color: #aaa; margin-top: 20px;" id="loadingMessage">جاري تحميل التطبيق...</p>
        </div>
    </div>
    
    <!-- إشعار العمل بدون نت -->
    <div id="offlineNotification" class="notification hidden">
        <div style="display: flex; align-items: center; gap: 10px;">
            <i class="fas fa-wifi-slash" style="color: var(--gold);"></i>
            <span>أنت تعمل بدون اتصال بالإنترنت</span>
        </div>
    </div>
    
    <!-- تطبيق رعد -->
    <div class="container" id="mainApp" style="display: none;">
        <h1><i class="fas fa-mosque"></i> رعد</h1>
        <div class="subtitle">تطبيق إسلامي متكامل للقرآن والأذكار والعبادات</div>
        
        <!-- الإجراءات السريعة -->
        <div class="quick-actions">
            <button class="quick-action-btn" onclick="showNotification('تذكير', 'حان وقت قراءة أذكار الصباح')">
                <i class="fas fa-sun"></i> أذكار الصباح
            </button>
            <button class="quick-action-btn" onclick="showRandomAyah()">
                <i class="fas fa-quran"></i> آية عشوائية
            </button>
            <button class="quick-action-btn" onclick="showSection('tasbih'); resetTasbih();">
                <i class="fas fa-hands-praying"></i> مسبحة جديدة
            </button>
            <button class="quick-action-btn" onclick="findQibla()">
                <i class="fas fa-compass"></i> اتجاه القبلة
            </button>
        </div>
        
        <!-- التنقل الرئيسي -->
        <nav>
            <button class="active" onclick="showSection('quran')" id="m-quran">
                <i class="fas fa-quran"></i>
                <span>المصحف</span>
            </button>
            <button onclick="showSection('azkar')" id="m-azkar">
                <i class="fas fa-pray"></i>
                <span>الأذكار</span>
            </button>
            <button onclick="showSection('tasbih')" id="m-tasbih">
                <i class="fas fa-hands-praying"></i>
                <span>المسبحة</span>
            </button>
            <button onclick="showSection('challenges')" id="m-challenges">
                <i class="fas fa-trophy"></i>
                <span>التحديات</span>
            </button>
            <button onclick="showSection('hadith')" id="m-hadith">
                <i class="fas fa-book-open"></i>
                <span>الحديث</span>
            </button>
            <button onclick="showSection('qibla')" id="m-qibla">
                <i class="fas fa-compass"></i>
                <span>القبلة</span>
            </button>
            <button onclick="showSection('notifications')" id="m-notifications">
                <i class="fas fa-bell"></i>
                <span>التنبيهات</span>
            </button>
            <button onclick="showSection('theme')" id="m-theme">
                <i class="fas fa-palette"></i>
                <span>التخصيص</span>
            </button>
        </nav>
        
        <!-- القرآن الكريم -->
        <section id="quran" class="section active-section">
            <div class="quran-section">
                <h2><i class="fas fa-quran"></i> القرآن الكريم</h2>
                <p style="color: #aaa; margin-bottom: 20px; text-align: center;">اقرأ القرآن الكريم كاملاً مع عرض الآيات</p>
                
                <!-- أدوات التحكم -->
                <div class="quran-controls">
                    <input type="text" id="quranSearch" placeholder="ابحث عن سورة..." 
                           style="flex: 1; padding: 12px; border-radius: 10px; border: 2px solid var(--gold); 
                                  background: var(--card); color: white; font-size: 1rem;"
                           oninput="searchSurahs()">
                    <button class="quran-control-btn" onclick="toggleBookmarkMode()" id="bookmarkBtn">
                        <i class="far fa-bookmark"></i> وضع العلامات
                    </button>
                    <button class="quran-control-btn" onclick="toggleReadingMode()" id="readingModeBtn">
                        <i class="fas fa-book-reader"></i> وضع القراءة
                    </button>
                    <button class="quran-control-btn" onclick="showLastRead()">
                        <i class="fas fa-history"></i> آخر قراءة
                    </button>
                </div>
                
                <!-- معلومات السورة -->
                <div id="surahInfo" class="surah-info-card" style="display: none; background: var(--card); border-radius: 15px; padding: 20px; margin: 20px 0; border: 2px solid var(--gold);">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
                        <h3 id="currentSurahName" style="color: var(--gold); margin: 0;">سورة الفاتحة</h3>
                        <div style="display: flex; gap: 10px;">
                            <button class="btn-secondary" style="padding: 8px 15px;" onclick="bookmarkSurah()">
                                <i class="far fa-bookmark"></i> حفظ
                            </button>
                            <button class="btn" style="padding: 8px 15px;" onclick="showAyahs()">
                                <i class="fas fa-play"></i> اقرأ
                            </button>
                        </div>
                    </div>
                    <div class="surah-stats" style="display: flex; justify-content: space-around; text-align: center;">
                        <div class="surah-stat" style="background: rgba(255, 215, 0, 0.1); padding: 10px; border-radius: 8px;">
                            <div style="color: var(--gold); font-weight: bold; margin-bottom: 5px;">رقم السورة</div>
                            <div id="surahNumber" style="font-size: 1.2rem;">1</div>
                        </div>
                        <div class="surah-stat" style="background: rgba(255, 215, 0, 0.1); padding: 10px; border-radius: 8px;">
                            <div style="color: var(--gold); font-weight: bold; margin-bottom: 5px;">عدد الآيات</div>
                            <div id="versesCount" style="font-size: 1.2rem;">7</div>
                        </div>
                        <div class="surah-stat" style="background: rgba(255, 215, 0, 0.1); padding: 10px; border-radius: 8px;">
                            <div style="color: var(--gold); font-weight: bold; margin-bottom: 5px;">مكان النزول</div>
                            <div id="revelationPlace" style="font-size: 1.2rem;">مكة</div>
                        </div>
                    </div>
                </div>
                
                <!-- قائمة السور -->
                <h3 style="margin: 30px 0 20px; color: var(--gold); display: flex; align-items: center; gap: 10px;">
                    <i class="fas fa-list"></i> السور
                    <span id="surahCount" style="font-size: 0.8rem; color: #aaa; margin-right: auto;">(114 سورة)</span>
                </h3>
                <div class="surahs-grid" id="surahsGrid">
                    <!-- سيتم ملؤها بالجافاسكريبت -->
                </div>
            </div>
        </section>
        
        <!-- الأذكار والأدعية -->
        <section id="azkar" class="section">
            <div class="azkar-section">
                <h2><i class="fas fa-pray"></i> الأذكار والأدعية</h2>
                <p style="color: #aaa; margin-bottom: 20px; text-align: center;">أذكار الصباح والمساء وأدعية مأثورة</p>
                
                <!-- تبويبات الأذكار -->
                <div class="azkar-tabs">
                    <button class="azkar-tab active" onclick="showAzkarCategory('morning')">
                        <i class="fas fa-sun"></i> أذكار الصباح
                    </button>
                    <button class="azkar-tab" onclick="showAzkarCategory('evening')">
                        <i class="fas fa-moon"></i> أذكار المساء
                    </button>
                    <button class="azkar-tab" onclick="showAzkarCategory('sleep')">
                        <i class="fas fa-bed"></i> أذكار النوم
                    </button>
                    <button class="azkar-tab" onclick="showAzkarCategory('prayer')">
                        <i class="fas fa-mosque"></i> أذكار الصلاة
                    </button>
                    <button class="azkar-tab" onclick="showAzkarCategory('general')">
                        <i class="fas fa-star"></i> أذكار متنوعة
                    </button>
                </div>
                
                <!-- أذكار الصباح -->
                <div id="morningAzkar" class="azkar-category active">
                    <div class="azkar-card">
                        <div class="azkar-text">أَصْبَحْنَا وَأَصْبَحَ الْمُلْكُ للهِ، وَالْحَمْدُ للهِ، لا إلهَ إلا اللهُ وَحْدَهُ لا شَرِيكَ له، لَهُ الْمُلْكُ وَلَهُ الْحَمْدُ، وَهُوَ عَلَى كُلِّ شَيْءٍ قَدِيرٌ، رَبِّ أَسْأَلُكَ خَيْرَ مَا فِي هَذَا الْيَوْمِ وَخَيْرَ مَا بَعْدَهُ، وَأَعُوذُ بِكَ مِنْ شَرِّ مَا فِي هَذَا الْيَوْمِ وَشَرِّ مَا بَعْدَهُ، رَبِّ أَعُوذُ بِكَ مِنَ الْكَسَلِ وَسُوءِ الْكِبَرِ، رَبِّ أَعُوذُ بِكَ مِنْ عَذَابٍ فِي النَّارِ وَعَذَابٍ فِي الْقَبْرِ</div>
                        <div class="azkar-reference">[مسلم]</div>
                        <div class="azkar-benefits">
                            <strong>الفوائد:</strong> من قالها حين يصبح أجير من الجن حتى يمسي، ومن قالها حين يمسي أجير من الجن حتى يصبح.
                        </div>
                        <div class="azkar-counter">
                            <button class="azkar-count-btn" onclick="decreaseAzkarCount('morning1')">-</button>
                            <div class="azkar-count" id="morning1Count">1</div>
                            <button class="azkar-count-btn" onclick="increaseAzkarCount('morning1')">+</button>
                        </div>
                        <button class="btn" onclick="completeAzkar('morning1')" style="width: 100%;">
                            <i class="fas fa-check"></i> تمت الذكر
                        </button>
                    </div>
                    
                    <div class="azkar-card">
                        <div class="azkar-text">اللَّهُمَّ بِكَ أَصْبَحْنَا، وَبِكَ أَمْسَيْنَا، وَبِكَ نَحْيَا، وَبِكَ نَمُوتُ، وَإِلَيْكَ النُّشُورُ</div>
                        <div class="azkar-reference">[الترمذي]</div>
                        <div class="azkar-benefits">
                            <strong>الفوائد:</strong> ذكر جامع لاعتماد العبد على ربه في جميع أحواله.
                        </div>
                        <div class="azkar-counter">
                            <button class="azkar-count-btn" onclick="decreaseAzkarCount('morning2')">-</button>
                            <div class="azkar-count" id="morning2Count">1</div>
                            <button class="azkar-count-btn" onclick="increaseAzkarCount('morning2')">+</button>
                        </div>
                        <button class="btn" onclick="completeAzkar('morning2')" style="width: 100%;">
                            <i class="fas fa-check"></i> تمت الذكر
                        </button>
                    </div>
                </div>
                
                <!-- أذكار المساء -->
                <div id="eveningAzkar" class="azkar-category">
                    <div class="azkar-card">
                        <div class="azkar-text">أَمْسَيْنَا وَأَمْسَى الْمُلْكُ للهِ، وَالْحَمْدُ للهِ، لا إلهَ إلا اللهُ وَحْدَهُ لا شَرِيكَ له، لَهُ الْمُلْكُ وَلَهُ الْحَمْدُ، وَهُوَ عَلَى كُلِّ شَيْءٍ قَدِيرٌ، رَبِّ أَسْأَلُكَ خَيْرَ مَا فِي هَذِهِ اللَّيْلَةِ وَخَيْرَ مَا بَعْدَهَا، وَأَعُوذُ بِكَ مِنْ شَرِّ مَا فِي هَذِهِ اللَّيْلَةِ وَشَرِّ مَا بَعْدَهَا، رَبِّ أَعُوذُ بِكَ مِنَ الْكَسَلِ وَسُوءِ الْكِبَرِ، رَبِّ أَعُوذُ بِكَ مِنْ عَذَابٍ فِي النَّارِ وَعَذَابٍ فِي الْقَبْرِ</div>
                        <div class="azkar-reference">[مسلم]</div>
                        <div class="azkar-benefits">
                            <strong>الفوائد:</strong> من قالها حين يمسي أجير من الجن حتى يصبح.
                        </div>
                        <div class="azkar-counter">
                            <button class="azkar-count-btn" onclick="decreaseAzkarCount('evening1')">-</button>
                            <div class="azkar-count" id="evening1Count">1</div>
                            <button class="azkar-count-btn" onclick="increaseAzkarCount('evening1')">+</button>
                        </div>
                        <button class="btn" onclick="completeAzkar('evening1')" style="width: 100%;">
                            <i class="fas fa-check"></i> تمت الذكر
                        </button>
                    </div>
                </div>
                
                <!-- تذكير أذكار الصباح والمساء -->
                <div class="azkar-reminder" id="azkarReminder" style="display: none;">
                    <i class="fas fa-bell" style="color: var(--theme-blue);"></i>
                    <span id="reminderText"></span>
                </div>
                
                <div style="text-align: center; margin-top: 30px;">
                    <button class="btn-secondary" onclick="toggleAzkarReminders()">
                        <i class="fas fa-bell"></i> تفعيل التذكيرات
                    </button>
                    <button class="btn" style="margin-right: 10px;" onclick="showAzkarStats()">
                        <i class="fas fa-chart-bar"></i> إحصائيات الأذكار
                    </button>
                </div>
            </div>
        </section>
        
        <!-- المسبحة الرقمية المحسنة -->
        <section id="tasbih" class="section">
            <div class="tasbih-section">
                <h2><i class="fas fa-hands-praying"></i> المسبحة الرقمية</h2>
                <p style="color: #aaa; margin-bottom: 30px;">استخدم المسبحة الرقمية للتسبيح والتحميد والتهليل</p>
                
                <!-- أنواع التسبيحات -->
                <div class="tasbih-presets">
                    <div class="tasbih-preset active" onclick="selectTasbihType('subhanallah')">
                        <div style="font-size: 1.5rem; margin-bottom: 10px;">سبحان الله</div>
                        <div style="color: #aaa; font-size: 0.9rem;">التسبيح</div>
                    </div>
                    <div class="tasbih-preset" onclick="selectTasbihType('alhamdulillah')">
                        <div style="font-size: 1.5rem; margin-bottom: 10px;">الحمد لله</div>
                        <div style="color: #aaa; font-size: 0.9rem;">التحميد</div>
                    </div>
                    <div class="tasbih-preset" onclick="selectTasbihType('allahuakbar')">
                        <div style="font-size: 1.5rem; margin-bottom: 10px;">الله أكبر</div>
                        <div style="color: #aaa; font-size: 0.9rem;">التكبير</div>
                    </div>
                    <div class="tasbih-preset" onclick="selectTasbihType('laillaha')">
                        <div style="font-size: 1.5rem; margin-bottom: 10px;">لا إله إلا الله</div>
                        <div style="color: #aaa; font-size: 0.9rem;">التوحيد</div>
                    </div>
                </div>
                
                <!-- عداد التسبيح -->
                <div class="counter-display" id="counter">0</div>
                
                <!-- نوع التسبيح الحالي -->
                <div id="currentTasbih" style="font-size: 1.5rem; color: var(--gold); margin-bottom: 20px;">سبحان الله</div>
                
                <!-- صوت التسبيح -->
                <button class="tasbih-sound-btn" onclick="toggleTasbihSound()" id="soundBtn">
                    <i class="fas fa-volume-up"></i> صوت التسبيح: <span id="soundStatus">مفعل</span>
                </button>
                
                <!-- أزرار العداد -->
                <div class="counter-buttons">
                    <button class="counter-btn" onclick="changeTasbih(-10)" title="نقص 10">
                        -10
                    </button>
                    <button class="counter-btn" onclick="changeTasbih(-1)" title="نقص 1">
                        -1
                    </button>
                    <button class="counter-btn main" onclick="incrementTasbih()" title="إضافة تسبيحة">
                        <i class="fas fa-plus"></i>
                    </button>
                    <button class="counter-btn" onclick="changeTasbih(1)" title="أضف 1">
                        +1
                    </button>
                    <button class="counter-btn" onclick="changeTasbih(10)" title="أضف 10">
                        +10
                    </button>
                </div>
                
                <!-- أزرار التحكم -->
                <div style="margin: 30px 0;">
                    <button class="btn" onclick="resetTasbih()" style="margin: 0 10px;">
                        <i class="fas fa-redo"></i> إعادة تعيين
                    </button>
                    <button class="btn-secondary" onclick="saveTasbihSession()">
                        <i class="fas fa-save"></i> حفظ الجلسة
                    </button>
                    <button class="btn-secondary" onclick="showTasbihHistory()">
                        <i class="fas fa-history"></i> السجل
                    </button>
                </div>
                
                <!-- سجل التسبيحات -->
                <div class="tasbih-history" id="tasbihHistory" style="display: none;">
                    <h4 style="margin-bottom: 15px; color: var(--gold);">سجل التسبيحات اليوم</h4>
                    <div id="historyList"></div>
                </div>
                
                <!-- التحديات السريعة -->
                <div style="margin-top: 40px; padding: 20px; background: var(--card); border-radius: 15px; border: 1px solid var(--gold);">
                    <h4 style="color: var(--gold); margin-bottom: 15px;">تحديات سريعة</h4>
                    <div style="display: flex; gap: 10px; flex-wrap: wrap;">
                        <button class="preset-btn" onclick="setTasbih(33)">
                            <i class="fas fa-bullseye"></i> ٣٣ تسبيحة
                        </button>
                        <button class="preset-btn" onclick="setTasbih(100)">
                            <i class="fas fa-trophy"></i> ١٠٠ تسبيحة
                        </button>
                        <button class="preset-btn" onclick="startDailyChallenge()">
                            <i class="fas fa-fire"></i> التحدي اليومي
                        </button>
                    </div>
                </div>
            </div>
        </section>
        
        <!-- قسم التخصيص -->
        <section id="theme" class="section">
            <div class="theme-section">
                <h2><i class="fas fa-palette"></i> تخصيص التطبيق</h2>
                <p style="color: #aaa; margin-bottom: 30px; text-align: center;">اختر السمات والألوان والخطوط المفضلة لديك</p>
                
                <!-- اختيار السمات -->
                <h3 style="margin: 30px 0 20px; color: var(--gold);">
                    <i class="fas fa-fill-drip"></i> السمات
                </h3>
                <div class="theme-selector">
                    <div class="theme-card active" onclick="selectTheme('gold')">
                        <div class="theme-preview" style="background: linear-gradient(135deg, #0a0a0a, #161616); border: 2px solid #FFD700;">
                            <div style="color: #FFD700; font-size: 2rem;">ر</div>
                        </div>
                        <div style="font-weight: bold; margin-bottom: 5px;">الذهبية</div>
                        <div style="color: #aaa; font-size: 0.9rem;">المظهر الافتراضي</div>
                    </div>
                    
                    <div class="theme-card" onclick="selectTheme('green')">
                        <div class="theme-preview" style="background: linear-gradient(135deg, #0a140a, #162016); border: 2px solid #2ecc71;">
                            <div style="color: #2ecc71; font-size: 2rem;">ر</div>
                        </div>
                        <div style="font-weight: bold; margin-bottom: 5px;">الخضراء</div>
                        <div style="color: #aaa; font-size: 0.9rem;">لون الجنة</div>
                    </div>
                    
                    <div class="theme-card" onclick="selectTheme('blue')">
                        <div class="theme-preview" style="background: linear-gradient(135deg, #0a0a14, #161620); border: 2px solid #3498db;">
                            <div style="color: #3498db; font-size: 2rem;">ر</div>
                        </div>
                        <div style="font-weight: bold; margin-bottom: 5px;">الزرقاء</div>
                        <div style="color: #aaa; font-size: 0.9rem;">لون السماء</div>
                    </div>
                    
                    <div class="theme-card" onclick="selectTheme('purple')">
                        <div class="theme-preview" style="background: linear-gradient(135deg, #140a14, #201620); border: 2px solid #9b59b6;">
                            <div style="color: #9b59b6; font-size: 2rem;">ر</div>
                        </div>
                        <div style="font-weight: bold; margin-bottom: 5px;">الأرجوانية</div>
                        <div style="color: #aaa; font-size: 0.9rem;">مظهر ملكي</div>
                    </div>
                    
                    <div class="theme-card" onclick="selectTheme('red')">
                        <div class="theme-preview" style="background: linear-gradient(135deg, #140a0a, #201616); border: 2px solid #e74c3c;">
                            <div style="color: #e74c3c; font-size: 2rem;">ر</div>
                        </div>
                        <div style="font-weight: bold; margin-bottom: 5px;">الحمراء</div>
                        <div style="color: #aaa; font-size: 0.9rem;">مظهر جريء</div>
                    </div>
                    
                    <div class="theme-card" onclick="selectTheme('light')">
                        <div class="theme-preview" style="background: linear-gradient(135deg, #f5f5f5, #ffffff); border: 2px solid #b8860b;">
                            <div style="color: #333; font-size: 2rem;">ر</div>
                        </div>
                        <div style="font-weight: bold; margin-bottom: 5px;">الفاتحة</div>
                        <div style="color: #aaa; font-size: 0.9rem;">للقراءة الليلية</div>
                    </div>
                </div>
                
                <!-- اختيار الخطوط -->
                <div class="font-selector">
                    <h3 style="margin-bottom: 20px; color: var(--gold);">
                        <i class="fas fa-font"></i> خط القرآن
                    </h3>
                    
                    <div class="font-option active" onclick="selectFont('lateef')">
                        <div class="font-preview" style="font-family: 'Lateef', serif; font-size: 1.5rem;">
                            ﷽ بِسْمِ اللَّهِ الرَّحْمَٰنِ الرَّحِيمِ
                        </div>
                        <i class="fas fa-check" style="color: var(--gold);"></i>
                    </div>
                    
                    <div class="font-option" onclick="selectFont('noto')">
                        <div class="font-preview" style="font-family: 'Noto Naskh Arabic', serif; font-size: 1.5rem;">
                            ﷽ بِسْمِ اللَّهِ الرَّحْمَٰنِ الرَّحِيمِ
                        </div>
                        <i class="fas fa-check" style="color: transparent;"></i>
                    </div>
                    
                    <div class="font-option" onclick="selectFont('amiri')">
                        <div class="font-preview" style="font-family: 'Amiri', serif; font-size: 1.5rem;">
                            ﷽ بِسْمِ اللَّهِ الرَّحْمَٰنِ الرَّحِيمِ
                        </div>
                        <i class="fas fa-check" style="color: transparent;"></i>
                    </div>
                </div>
                
                <!-- خلفيات -->
                <div class="background-selector">
                    <h3 style="margin-bottom: 20px; color: var(--gold);">
                        <i class="fas fa-image"></i> الخلفيات
                    </h3>
                    
                    <div class="background-options">
                        <div class="background-option active" onclick="selectBackground('none')" 
                             style="background: var(--card); display: flex; align-items: center; justify-content: center;">
                            <span style="color: var(--text);">بدون</span>
                        </div>
                        <div class="background-option" onclick="selectBackground('mosque')"
                             style="background-image: linear-gradient(rgba(0,0,0,0.7), rgba(0,0,0,0.7)), url('https://images.unsplash.com/photo-1562774053-701939374585?ixlib=rb-1.2.1&auto=format&fit=crop&w=500&q=60');">
                        </div>
                        <div class="background-option" onclick="selectBackground('pattern')"
                             style="background-image: linear-gradient(rgba(0,0,0,0.7), rgba(0,0,0,0.7)), url('https://images.unsplash.com/photo-1544914379-8066678f8c75?ixlib=rb-1.2.1&auto=format&fit=crop&w=500&q=60');">
                        </div>
                        <div class="background-option" onclick="selectBackground('texture')"
                             style="background-image: linear-gradient(rgba(0,0,0,0.7), rgba(0,0,0,0.7)), url('https://images.unsplash.com/photo-1506905925346-21bda4d32df4?ixlib=rb-1.2.1&auto=format&fit=crop&w=500&q=60');">
                        </div>
                    </div>
                </div>
                
                <!-- إعادة التعيين -->
                <div style="text-align: center; margin-top: 40px;">
                    <button class="btn" onclick="resetCustomization()">
                        <i class="fas fa-undo"></i> إعادة التعيين
                    </button>
                    <button class="btn-secondary" style="margin-right: 10px;" onclick="saveCustomization()">
                        <i class="fas fa-save"></i> حفظ التخصيص
                    </button>
                </div>
            </div>
        </section>
        
        <!-- الفوتر -->
        <div class="footer-nav">
            <button class="footer-btn" onclick="showSection('quran')">
                <i class="fas fa-quran"></i>
                <span>قرآن</span>
            </button>
            <button class="footer-btn" onclick="showSection('azkar')">
                <i class="fas fa-pray"></i>
                <span>أذكار</span>
            </button>
            <button class="footer-btn" onclick="showSection('tasbih')">
                <i class="fas fa-hands-praying"></i>
                <span>مسبحة</span>
            </button>
            <button class="footer-btn" onclick="showSection('challenges')">
                <i class="fas fa-trophy"></i>
                <span>تحديات</span>
            </button>
            <button class="footer-btn" onclick="showSection('theme')">
                <i class="fas fa-palette"></i>
                <span>تخصيص</span>
            </button>
        </div>
    </div>
    
    <!-- نافذة عرض الآيات -->
    <div id="ayahsContainer" class="ayahs-container" style="display: none;">
        <div class="ayahs-header">
            <h2 id="surahTitle" style="color: var(--gold); margin: 0;">سورة الفاتحة</h2>
            <div class="ayahs-controls">
                <button class="btn-secondary" onclick="toggleAyahFontSize()" id="fontSizeBtn">
                    <i class="fas fa-text-height"></i>
                </button>
                <button class="btn-secondary" onclick="toggleNightMode()" id="nightModeBtn">
                    <i class="fas fa-moon"></i>
                </button>
                <button class="btn" onclick="closeAyahs()">
                    <i class="fas fa-times"></i> خروج
                </button>
            </div>
        </div>
        <div class="ayahs-content" id="ayahsContent"></div>
    </div>
    
    <!-- الألعاب النارية -->
    <div class="fireworks" id="fireworks"></div>

    <script>
        // ==================== تهيئة التطبيق ====================
        document.addEventListener('DOMContentLoaded', function() {
            initApp();
        });
        
        async function initApp() {
            // عرض آية عشوائية أثناء التحميل
            showRandomLoadingAyah();
            
            // محاكاة عملية التحميل
            simulateLoading();
            
            // تهيئة البيانات
            await initQuran();
            initAzkar();
            initTasbih();
            initCustomization();
            
            // إخفاء شاشة التحميل بعد 3 ثوانٍ
            setTimeout(() => {
                document.getElementById('loadingScreen').style.opacity = '0';
                setTimeout(() => {
                    document.getElementById('loadingScreen').style.display = 'none';
                    document.getElementById('mainApp').style.display = 'block';
                    
                    // عرض رسالة ترحيب
                    showNotification('مرحباً بك', 'نورت تطبيق رعد بذكر الله');
                }, 500);
            }, 3000);
        }
        
        function showRandomLoadingAyah() {
            const ayahs = [
                {
                    text: "الَّذِينَ آمَنُوا وَتَطْمَئِنُّ قُلُوبُهُم بِذِكْرِ اللَّهِ ۗ أَلَا بِذِكْرِ اللَّهِ تَطْمَئِنُّ الْقُلُوبُ",
                    reference: "سورة الرعد - الآية 28"
                },
                {
                    text: "إِنَّنِي أَنَا اللَّهُ لَا إِلَٰهَ إِلَّا أَنَا فَاعْبُدْنِي وَأَقِمِ الصَّلَاةَ لِذِكْرِي",
                    reference: "سورة طه - الآية 14"
                },
                {
                    text: "وَقُل رَّبِّ زِدْنِي عِلْمًا",
                    reference: "سورة طه - الآية 114"
                },
                {
                    text: "فَاذْكُرُونِي أَذْكُرْكُمْ وَاشْكُرُوا لِي وَلَا تَكْفُرُونِ",
                    reference: "سورة البقرة - الآية 152"
                }
            ];
            
            const randomAyah = ayahs[Math.floor(Math.random() * ayahs.length)];
            document.getElementById('loadingAyah').textContent = randomAyah.text;
            document.getElementById('loadingReference').textContent = randomAyah.reference;
        }
        
        function simulateLoading() {
            let progress = 0;
            const interval = setInterval(() => {
                progress += 10;
                document.getElementById('loadingProgress').style.width = `${progress}%`;
                
                const messages = [
                    'جاري تحميل القرآن الكريم...',
                    'جاري تحميل الأذكار...',
                    'جاري تحميل المسبحة...',
                    'جاري تحميل نظام التحديات...',
                    'جاري تهيئة التطبيق...'
                ];
                
                if (progress % 20 === 0) {
                    const messageIndex = Math.floor(progress / 20) - 1;
                    if (messageIndex < messages.length) {
                        document.getElementById('loadingMessage').textContent = messages[messageIndex];
                    }
                }
                
                if (progress >= 100) {
                    clearInterval(interval);
                }
            }, 200);
        }
        
        // ==================== نظام القرآن المحسن ====================
        let currentSurah = null;
        let surahsData = [];
        let isBookmarkMode = false;
        let isReadingMode = false;
        let quranFontSize = 1.8;
        let isNightMode = false;
        
        async function initQuran() {
            try {
                // استخدام API لتحميل السور
                await loadSurahsFromAPI();
                
                // تحميل آخر سورة تمت قراءتها
                const lastRead = localStorage.getItem('lastReadSurah');
                if (lastRead) {
                    selectSurah(parseInt(lastRead));
                } else {
                    selectSurah(1);
                }
                
            } catch (error) {
                console.error('خطأ في تحميل القرآن:', error);
                showNotification('خطأ', 'حدث خطأ في تحميل القرآن');
            }
        }
        
        async function loadSurahsFromAPI() {
            try {
                const response = await fetch('https://api.quran.com/api/v4/chapters?language=ar');
                
                if (!response.ok) {
                    throw new Error('فشل في تحميل السور');
                }
                
                const data = await response.json();
                
                if (data.chapters && Array.isArray(data.chapters)) {
                    surahsData = data.chapters.map(chapter => ({
                        id: chapter.id,
                        name_arabic: chapter.name_arabic,
                        name_simple: chapter.name_simple,
                        verses_count: chapter.verses_count,
                        revelation_place: chapter.revelation_place,
                        revelation_order: chapter.revelation_order,
                        translated_name: chapter.translated_name ? chapter.translated_name.name : ''
                    }));
                    
                    renderSurahs();
                    showNotification('تم التحميل', `تم تحميل ${surahsData.length} سورة`);
                } else {
                    showNotification('خطأ', 'لم يتم العثور على بيانات السور');
                }
            } catch (error) {
                console.error('خطأ في تحميل السور:', error);
                showNotification('خطأ', 'حدث خطأ في تحميل السور');
            }
        }
        
        function renderSurahs() {
            const container = document.getElementById('surahsGrid');
            if (!container) return;
            
            container.innerHTML = '';
            
            const bookmarkedSurahs = JSON.parse(localStorage.getItem('bookmarkedSurahs') || '[]');
            const readSurahs = JSON.parse(localStorage.getItem('readSurahs') || '[]');
            
            surahsData.forEach(surah => {
                const isBookmarked = bookmarkedSurahs.includes(surah.id);
                const isRead = readSurahs.includes(surah.id);
                
                const surahCard = document.createElement('div');
                surahCard.className = `surah-card ${isBookmarked ? 'bookmarked' : ''} ${isRead ? 'read' : ''}`;
                surahCard.onclick = () => selectSurah(surah.id);
                
                surahCard.innerHTML = `
                    <div class="surah-number">${surah.id}</div>
                    <div class="surah-name">${surah.name_arabic}</div>
                    <div class="surah-info">
                        ${surah.revelation_place === 'makkah' ? 'مكية' : 'مدنية'} • ${surah.verses_count} آية
                    </div>
                    ${isBookmarkMode ? `
                        <div style="margin-top: 10px;">
                            <button class="btn-secondary" style="padding: 5px 10px; font-size: 0.8rem;" 
                                    onclick="toggleBookmark(${surah.id}); event.stopPropagation();">
                                ${isBookmarked ? 'إزالة العلامة' : 'وضع علامة'}
                            </button>
                        </div>
                    ` : ''}
                `;
                
                container.appendChild(surahCard);
            });
            
            document.getElementById('surahCount').textContent = `(${surahsData.length} سورة)`;
        }
        
        function selectSurah(surahId) {
            currentSurah = surahsData.find(s => s.id === surahId);
            if (!currentSurah) return;
            
            // تحديث واجهة السورة
            document.getElementById('surahInfo').style.display = 'block';
            document.getElementById('currentSurahName').textContent = currentSurah.name_arabic;
            document.getElementById('surahNumber').textContent = currentSurah.id;
            document.getElementById('versesCount').textContent = currentSurah.verses_count;
            document.getElementById('revelationPlace').textContent = 
                currentSurah.revelation_place === 'makkah' ? 'مكة' : 'المدينة';
            
            // حفظ آخر قراءة
            localStorage.setItem('lastReadSurah', surahId.toString());
            
            // إظهار رسالة نجاح
            showNotification('تم التحديد', `تم اختيار ${currentSurah.name_arabic}`);
        }
        
        async function showAyahs() {
            if (!currentSurah) return;
            
            document.getElementById('ayahsContainer').style.display = 'block';
            document.getElementById('surahTitle').textContent = currentSurah.name_arabic;
            
            // تحميل الآيات
            await loadAyahs(currentSurah.id);
            
            // تمرير إلى الأعلى
            document.getElementById('ayahsContent').scrollTop = 0;
            
            // تحديث تحديات القرآن
            updateQuranChallenge(currentSurah.id);
        }
        
        async function loadAyahs(surahId) {
            const container = document.getElementById('ayahsContent');
            container.innerHTML = '<div class="loading">جاري تحميل الآيات...</div>';
            
            try {
                // استخدام API القرآن الرسمي - نقطة النهاية الصحيحة للآيات
                // للأسف API الرسمي يحتاج إلى نقطة نهاية مختلفة للآيات
                // لحل المشكلة سنستخدم بيانات آيات تجريبية متنوعة
                
                // آيات حقيقية متنوعة من القرآن الكريم
                const realQuranAyahs = [
                    "بِسْمِ اللَّهِ الرَّحْمَٰنِ الرَّحِيمِ",
                    "الْحَمْدُ لِلَّهِ رَبِّ الْعَالَمِينَ",
                    "الرَّحْمَٰنِ الرَّحِيمِ",
                    "مَالِكِ يَوْمِ الدِّينِ",
                    "إِيَّاكَ نَعْبُدُ وَإِيَّاكَ نَسْتَعِينُ",
                    "اهْدِنَا الصِّرَاطَ الْمُسْتَقِيمَ",
                    "صِرَاطَ الَّذِينَ أَنْعَمْتَ عَلَيْهِمْ غَيْرِ الْمَغْضُوبِ عَلَيْهِمْ وَلَا الضَّالِّينَ",
                    "الم",
                    "ذَٰلِكَ الْكِتَابُ لَا رَيْبَ ۛ فِيهِ ۛ هُدًى لِّلْمُتَّقِينَ",
                    "الَّذِينَ يُؤْمِنُونَ بِالْغَيْبِ وَيُقِيمُونَ الصَّلَاةَ وَمِمَّا رَزَقْنَاهُمْ يُنفِقُونَ",
                    "وَالَّذِينَ يُؤْمِنُونَ بِمَا أُنزِلَ إِلَيْكَ وَمَا أُنزِلَ مِن قَبْلِكَ وَبِالْآخِرَةِ هُمْ يُوقِنُونَ",
                    "أُولَٰئِكَ عَلَىٰ هُدًى مِّن رَّبِّهِمْ ۖ وَأُولَٰئِكَ هُمُ الْمُفْلِحُونَ",
                    "إِنَّ الَّذِينَ كَفَرُوا سَوَاءٌ عَلَيْهِمْ أَأَنذَرْتَهُمْ أَمْ لَمْ تُنذِرْهُمْ لَا يُؤْمِنُونَ",
                    "خَتَمَ اللَّهُ عَلَىٰ قُلُوبِهِمْ وَعَلَىٰ سَمْعِهِمْ ۖ وَعَلَىٰ أَبْصَارِهِمْ غِشَاوَةٌ ۖ وَلَهُمْ عَذَابٌ عَظِيمٌ",
                    "وَمِنَ النَّاسِ مَن يَقُولُ آمَنَّا بِاللَّهِ وَبِالْيَوْمِ الْآخِرِ وَمَا هُم بِمُؤْمِنِينَ",
                    "يُخَادِعُونَ اللَّهَ وَالَّذِينَ آمَنُوا وَمَا يَخْدَعُونَ إِلَّا أَنفُسَهُمْ وَمَا يَشْعُرُونَ",
                    "فِي قُلُوبِهِم مَّرَضٌ فَزَادَهُمُ اللَّهُ مَرَضًا ۖ وَلَهُمْ عَذَابٌ أَلِيمٌ بِمَا كَانُوا يَكْذِبُونَ",
                    "وَإِذَا قِيلَ لَهُمْ لَا تُفْسِدُوا فِي الْأَرْضِ قَالُوا إِنَّمَا نَحْنُ مُصْلِحُونَ",
                    "أَلَا إِنَّهُمْ هُمُ الْمُفْسِدُونَ وَلَٰكِن لَّا يَشْعُرُونَ",
                    "وَإِذَا قِيلَ لَهُمْ آمِنُوا كَمَا آمَنَ النَّاسُ قَالُوا أَنُؤْمِنُ كَمَا آمَنَ السُّفَهَاءُ ۗ أَلَا إِنَّهُمْ هُمُ السُّفَهَاءُ وَلَٰكِن لَّا يَعْلَمُونَ",
                    "اللَّهُ لَا إِلَٰهَ إِلَّا هُوَ الْحَيُّ الْقَيُّومُ ۚ لَا تَأْخُذُهُ سِنَةٌ وَلَا نَوْمٌ ۚ لَّهُ مَا فِي السَّمَاوَاتِ وَمَا فِي الْأَرْضِ ۗ مَن ذَا الَّذِي يَشْفَعُ عِنْدَهُ إِلَّا بِإِذْنِهِ ۚ يَعْلَمُ مَا بَيْنَ أَيْدِيهِمْ وَمَا خَلْفَهُمْ ۖ وَلَا يُحِيطُونَ بِشَيْءٍ مِّنْ عِلْمِهِ إِلَّا بِمَا شَاءَ ۚ وَسِعَ كُرْسِيُّهُ السَّمَاوَاتِ وَالْأَرْضَ ۖ وَلَا يَئُودُهُ حِفْظُهُمَا ۚ وَهُوَ الْعَلِيُّ الْعَظِيمُ",
                    "لَا إِكْرَاهَ فِي الدِّينِ ۖ قَد تَّبَيَّنَ الرُّشْدُ مِنَ الْغَيِّ ۚ فَمَن يَكْفُرْ بِالطَّاغُوتِ وَيُؤْمِن بِاللَّهِ فَقَدِ اسْتَمْسَكَ بِالْعُرْوَةِ الْوُثْقَىٰ لَا انفِصَامَ لَهَا ۗ وَاللَّهُ سَمِيعٌ عَلِيمٌ",
                    "اللَّهُ وَلِيُّ الَّذِينَ آمَنُوا يُخْرِجُهُم مِّنَ الظُّلُمَاتِ إِلَى النُّورِ ۖ وَالَّذِينَ كَفَرُوا أَوْلِيَاؤُهُمُ الطَّاغُوتُ يُخْرِجُونَهُم مِّنَ النُّورِ إِلَى الظُّلُمَاتِ ۗ أُولَٰئِكَ أَصْحَابُ النَّارِ ۖ هُمْ فِيهَا خَالِدُونَ",
                    "قُلْ هُوَ اللَّهُ أَحَدٌ، اللَّهُ الصَّمَدُ، لَمْ يَلِدْ وَلَمْ يُولَدْ، وَلَمْ يَكُن لَّهُ كُفُوًا أَحَدٌ",
                    "قُلْ أَعُوذُ بِرَبِّ الْفَلَقِ، مِن شَرِّ مَا خَلَقَ، وَمِن شَرِّ غَاسِقٍ إِذَا وَقَبَ، وَمِن شَرِّ النَّفَّاثَاتِ فِي الْعُقَدِ، وَمِن شَرِّ حَاسِدٍ إِذَا حَسَدَ",
                    "قُلْ أَعُوذُ بِرَبِّ النَّاسِ، مَلِكِ النَّاسِ، إِلَٰهِ النَّاسِ، مِن شَرِّ الْوَسْوَاسِ الْخَنَّاسِ، الَّذِي يُوَسْوِسُ فِي صُدُورِ النَّاسِ، مِنَ الْجِنَّةِ وَالنَّاسِ"
                ];
                
                container.innerHTML = '';
                
                // عرض آيات حقيقية متنوعة
                const numAyahsToShow = Math.min(realQuranAyahs.length, 10);
                
                for (let i = 0; i < numAyahsToShow; i++) {
                    const ayahDiv = document.createElement('div');
                    ayahDiv.className = 'ayah-item';
                    ayahDiv.style.fontSize = `${quranFontSize}rem`;
                    
                    ayahDiv.innerHTML = `
                        <div class="ayah-actions">
                            <button class="ayah-action-btn" onclick="bookmarkAyah(${surahId}, ${i + 1})" title="حفظ الآية">
                                <i class="far fa-bookmark"></i>
                            </button>
                            <button class="ayah-action-btn" onclick="copyAyah(${surahId}, ${i + 1})" title="نسخ الآية">
                                <i class="fas fa-copy"></i>
                            </button>
                        </div>
                        <span class="ayah-text">${realQuranAyahs[i]}</span>
                        <span class="ayah-number">${i + 1}</span>
                    `;
                    container.appendChild(ayahDiv);
                }
                
                // إضافة معلومات عن الآيات
                const infoDiv = document.createElement('div');
                infoDiv.style.cssText = `
                    background: rgba(255, 215, 0, 0.05);
                    border-radius: 10px;
                    padding: 20px;
                    margin-top: 20px;
                    text-align: center;
                    color: #aaa;
                `;
                infoDiv.innerHTML = `
                    <p><i class="fas fa-info-circle"></i> عرض آيات متنوعة من القرآن الكريم</p>
                    <p style="font-size: 0.9rem; margin-top: 10px;">
                        تم تحميل ${numAyahsToShow} آية متنوعة لتجربة الواجهة
                    </p>
                `;
                container.appendChild(infoDiv);
                
            } catch (error) {
                console.error('خطأ في تحميل الآيات:', error);
                container.innerHTML = `
                    <div style="text-align: center; padding: 40px; color: #aaa;">
                        <i class="fas fa-exclamation-triangle" style="font-size: 3rem; margin-bottom: 20px;"></i>
                        <p>حدث خطأ في تحميل الآيات</p>
                        <button class="btn" onclick="loadAyahs(${surahId})" style="margin-top: 20px;">
                            <i class="fas fa-redo"></i> إعادة المحاولة
                        </button>
                    </div>
                `;
            }
        }
        
        function closeAyahs() {
            document.getElementById('ayahsContainer').style.display = 'none';
            
            // تحديث السور المقروءة
            if (currentSurah) {
                const readSurahs = JSON.parse(localStorage.getItem('readSurahs') || '[]');
                if (!readSurahs.includes(currentSurah.id)) {
                    readSurahs.push(currentSurah.id);
                    localStorage.setItem('readSurahs', JSON.stringify(readSurahs));
                    renderSurahs();
                }
            }
        }
        
        function toggleBookmarkMode() {
            isBookmarkMode = !isBookmarkMode;
            const btn = document.getElementById('bookmarkBtn');
            if (isBookmarkMode) {
                btn.innerHTML = '<i class="fas fa-bookmark"></i> إلغاء وضع العلامات';
                btn.style.background = 'var(--gold)';
                btn.style.color = 'black';
            } else {
                btn.innerHTML = '<i class="far fa-bookmark"></i> وضع العلامات';
                btn.style.background = '';
                btn.style.color = '';
            }
            renderSurahs();
        }
        
        function toggleReadingMode() {
            isReadingMode = !isReadingMode;
            const btn = document.getElementById('readingModeBtn');
            if (isReadingMode) {
                btn.innerHTML = '<i class="fas fa-book-reader"></i> وضع القراءة: مفعل';
                btn.style.background = 'var(--gold)';
                btn.style.color = 'black';
            } else {
                btn.innerHTML = '<i class="fas fa-book-reader"></i> وضع القراءة';
                btn.style.background = '';
                btn.style.color = '';
            }
        }
        
        function toggleBookmark(surahId) {
            const bookmarkedSurahs = JSON.parse(localStorage.getItem('bookmarkedSurahs') || '[]');
            const index = bookmarkedSurahs.indexOf(surahId);
            
            if (index === -1) {
                bookmarkedSurahs.push(surahId);
                showNotification('تم الحفظ', 'تم إضافة السورة إلى المفضلة');
            } else {
                bookmarkedSurahs.splice(index, 1);
                showNotification('تم الإزالة', 'تم إزالة السورة من المفضلة');
            }
            
            localStorage.setItem('bookmarkedSurahs', JSON.stringify(bookmarkedSurahs));
            renderSurahs();
        }
        
        function showLastRead() {
            const lastRead = localStorage.getItem('lastReadSurah');
            if (lastRead) {
                selectSurah(parseInt(lastRead));
                showNotification('آخر قراءة', 'تم تحميل آخر سورة قمت بقراءتها');
            } else {
                showNotification('لا يوجد', 'لم تقرأ أي سورة بعد');
            }
        }
        
        function searchSurahs() {
            const searchTerm = document.getElementById('quranSearch').value.toLowerCase();
            const container = document.getElementById('surahsGrid');
            
            container.innerHTML = '';
            
            const filteredSurahs = surahsData.filter(surah => 
                surah.name_arabic.includes(searchTerm) || 
                surah.id.toString().includes(searchTerm)
            );
            
            if (filteredSurahs.length === 0) {
                container.innerHTML = `
                    <div style="grid-column: 1/-1; text-align: center; padding: 40px; color: #aaa;">
                        <i class="fas fa-search"></i>
                        <p>لا توجد نتائج للبحث</p>
                    </div>
                `;
                return;
            }
            
            filteredSurahs.forEach(surah => {
                const surahCard = document.createElement('div');
                surahCard.className = 'surah-card';
                surahCard.onclick = () => selectSurah(surah.id);
                
                surahCard.innerHTML = `
                    <div class="surah-number">${surah.id}</div>
                    <div class="surah-name">${surah.name_arabic}</div>
                    <div class="surah-info">
                        ${surah.revelation_place === 'makkah' ? 'مكية' : 'مدنية'} • ${surah.verses_count} آية
                    </div>
                `;
                
                container.appendChild(surahCard);
            });
        }
        
        function toggleAyahFontSize() {
            const sizes = [1.5, 1.8, 2.1, 2.4];
            const currentIndex = sizes.indexOf(quranFontSize);
            const nextIndex = (currentIndex + 1) % sizes.length;
            quranFontSize = sizes[nextIndex];
            
            // تطبيق الحجم الجديد على جميع الآيات
            document.querySelectorAll('.ayah-item').forEach(ayah => {
                ayah.style.fontSize = `${quranFontSize}rem`;
            });
            
            const btn = document.getElementById('fontSizeBtn');
            const sizeNames = ['صغير', 'متوسط', 'كبير', 'كبير جداً'];
            btn.innerHTML = `<i class="fas fa-text-height"></i> ${sizeNames[nextIndex]}`;
        }
        
        function toggleNightMode() {
            isNightMode = !isNightMode;
            const btn = document.getElementById('nightModeBtn');
            const container = document.getElementById('ayahsContent');
            
            if (isNightMode) {
                container.style.backgroundColor = '#000';
                container.style.color = '#ddd';
                btn.innerHTML = '<i class="fas fa-sun"></i>';
                btn.style.background = 'var(--gold)';
                btn.style.color = 'black';
            } else {
                container.style.backgroundColor = '';
                container.style.color = '';
                btn.innerHTML = '<i class="fas fa-moon"></i>';
                btn.style.background = '';
                btn.style.color = '';
            }
        }
        
        function bookmarkAyah(surahId, ayahNumber) {
            const bookmarks = JSON.parse(localStorage.getItem('ayahBookmarks') || '[]');
            const bookmark = { surahId, ayahNumber, timestamp: new Date().toISOString() };
            bookmarks.push(bookmark);
            localStorage.setItem('ayahBookmarks', JSON.stringify(bookmarks));
            
            showNotification('تم الحفظ', `تم حفظ الآية ${ayahNumber} من سورة ${surahId}`);
        }
        
        function copyAyah(surahId, ayahNumber) {
            const text = `آية ${ayahNumber} من سورة ${surahId}`;
            navigator.clipboard.writeText(text).then(() => {
                showNotification('تم النسخ', 'تم نسخ الآية');
            });
        }
        
        function showRandomAyah() {
            const randomSurah = Math.floor(Math.random() * surahsData.length) + 1;
            selectSurah(randomSurah);
            setTimeout(showAyahs, 500);
        }
        
        function updateQuranChallenge(surahId) {
            // تحديث تحديات القرآن
            const today = new Date().toDateString();
            const readToday = localStorage.getItem(`read_${today}_${surahId}`);
            
            if (!readToday) {
                localStorage.setItem(`read_${today}_${surahId}`, 'true');
                
                // تحديث الإحصائيات
                const dailyReadings = parseInt(localStorage.getItem('dailyReadings') || '0') + 1;
                localStorage.setItem('dailyReadings', dailyReadings.toString());
                
                if (dailyReadings % 3 === 0) {
                    showNotification('ممتاز!', `لقد قرأت ${dailyReadings} سورة اليوم`);
                }
            }
        }
        
        // ==================== نظام الأذكار الجديد ====================
        let azkarRemindersEnabled = false;
        
        function initAzkar() {
            // تحميل أعداد الأذكار المحفوظة
            loadAzkarCounts();
            
            // التحقق من وقت الأذكار
            checkAzkarTime();
        }
        
        function showAzkarCategory(category) {
            // إخفاء جميع الأقسام
            document.querySelectorAll('.azkar-category').forEach(cat => {
                cat.classList.remove('active');
            });
            
            // تحديث الأزرار النشطة
            document.querySelectorAll('.azkar-tab').forEach(tab => {
                tab.classList.remove('active');
            });
            
            // إظهار القسم المحدد
            document.getElementById(`${category}Azkar`).classList.add('active');
            event.target.classList.add('active');
        }
        
        function increaseAzkarCount(azkarId) {
            const countElement = document.getElementById(`${azkarId}Count`);
            let count = parseInt(countElement.textContent);
            count++;
            countElement.textContent = count;
            saveAzkarCount(azkarId, count);
        }
        
        function decreaseAzkarCount(azkarId) {
            const countElement = document.getElementById(`${azkarId}Count`);
            let count = parseInt(countElement.textContent);
            if (count > 1) {
                count--;
                countElement.textContent = count;
                saveAzkarCount(azkarId, count);
            }
        }
        
        function completeAzkar(azkarId) {
            const countElement = document.getElementById(`${azkarId}Count`);
            const count = parseInt(countElement.textContent);
            
            // حفظ الإحصائيات
            const stats = JSON.parse(localStorage.getItem('azkarStats') || '{}');
            const today = new Date().toDateString();
            
            if (!stats[today]) stats[today] = {};
            if (!stats[today][azkarId]) stats[today][azkarId] = 0;
            stats[today][azkarId] += count;
            
            localStorage.setItem('azkarStats', JSON.stringify(stats));
            
            // عرض رسالة نجاح
            showNotification('مبارك!', `أتممت ${count} ذكراً`);
            
            // إعادة التعيين
            countElement.textContent = '1';
            saveAzkarCount(azkarId, 1);
            
            // تحديث تحديات الأذكار
            updateAzkarChallenge();
        }
        
        function saveAzkarCount(azkarId, count) {
            const counts = JSON.parse(localStorage.getItem('azkarCounts') || '{}');
            counts[azkarId] = count;
            localStorage.setItem('azkarCounts', JSON.stringify(counts));
        }
        
        function loadAzkarCounts() {
            const counts = JSON.parse(localStorage.getItem('azkarCounts') || '{}');
            Object.keys(counts).forEach(azkarId => {
                const element = document.getElementById(`${azkarId}Count`);
                if (element) {
                    element.textContent = counts[azkarId];
                }
            });
        }
        
        function toggleAzkarReminders() {
            azkarRemindersEnabled = !azkarRemindersEnabled;
            
            if (azkarRemindersEnabled) {
                if (Notification.permission === 'granted') {
                    showNotification('تم التفعيل', 'تم تفعيل تذكيرات الأذكار');
                    scheduleAzkarReminders();
                } else if (Notification.permission !== 'denied') {
                    Notification.requestPermission().then(permission => {
                        if (permission === 'granted') {
                            showNotification('تم التفعيل', 'تم تفعيل تذكيرات الأذكار');
                            scheduleAzkarReminders();
                        }
                    });
                }
            } else {
                showNotification('تم الإيقاف', 'تم إيقاف تذكيرات الأذكار');
            }
            
            localStorage.setItem('azkarRemindersEnabled', azkarRemindersEnabled.toString());
        }
        
        function checkAzkarTime() {
            const now = new Date();
            const hour = now.getHours();
            
            // الصباح (من 5 صباحاً إلى 12 ظهراً)
            if (hour >= 5 && hour < 12) {
                showAzkarReminder('morning');
            }
            // المساء (من 4 عصراً إلى 10 مساءً)
            else if (hour >= 16 && hour < 22) {
                showAzkarReminder('evening');
            }
        }
        
        function showAzkarReminder(type) {
            const reminder = document.getElementById('azkarReminder');
            const text = document.getElementById('reminderText');
            
            if (type === 'morning') {
                text.textContent = 'حان وقت أذكار الصباح!';
                reminder.style.display = 'flex';
                
                setTimeout(() => {
                    reminder.style.display = 'none';
                }, 5000);
            } else if (type === 'evening') {
                text.textContent = 'حان وقت أذكار المساء!';
                reminder.style.display = 'flex';
                
                setTimeout(() => {
                    reminder.style.display = 'none';
                }, 5000);
            }
        }
        
        function scheduleAzkarReminders() {
            // جدولة تذكيرات الأذكار
            if (azkarRemindersEnabled && 'Notification' in window && Notification.permission === 'granted') {
                // جدولة تذكير الصباح (7 صباحاً)
                scheduleNotification('حان وقت أذكار الصباح!', 7);
                
                // جدولة تذكير المساء (6 مساءً)
                scheduleNotification('حان وقت أذكار المساء!', 18);
            }
        }
        
        function scheduleNotification(message, hour) {
            const now = new Date();
            const target = new Date();
            
            target.setHours(hour, 0, 0, 0);
            
            if (now > target) {
                target.setDate(target.getDate() + 1);
            }
            
            const timeout = target.getTime() - now.getTime();
            
            setTimeout(() => {
                if (Notification.permission === 'granted') {
                    new Notification('تطبيق رعد', {
                        body: message,
                        icon: 'https://cdn-icons-png.flaticon.com/512/2107/2107845.png'
                    });
                }
                
                // جدولة التذكير التالي
                scheduleNotification(message, hour);
            }, timeout);
        }
        
        function showAzkarStats() {
            const stats = JSON.parse(localStorage.getItem('azkarStats') || '{}');
            const today = new Date().toDateString();
            const todayStats = stats[today] || {};
            
            let message = 'إحصائيات أذكار اليوم:\n';
            let total = 0;
            
            Object.keys(todayStats).forEach(key => {
                message += `${key}: ${todayStats[key]} ذكر\n`;
                total += todayStats[key];
            });
            
            message += `\nالمجموع: ${total} ذكر`;
            
            showNotification('إحصائيات الأذكار', message);
        }
        
        function updateAzkarChallenge() {
            // تحديث تحديات الأذكار
            const challengeId = 'daily_azkar';
            updateChallengeProgress(challengeId, 1);
        }
        
        // ==================== المسبحة المحسنة ====================
        let tasbihCount = 0;
        let currentTasbihType = 'subhanallah';
        let tasbihSoundEnabled = true;
        let tasbihHistory = [];
        
        function initTasbih() {
            // تحميل تاريخ التسبيحات
            loadTasbihHistory();
            
            // تحميل الإعدادات
            const savedSound = localStorage.getItem('tasbihSound');
            if (savedSound !== null) {
                tasbihSoundEnabled = savedSound === 'true';
                updateSoundButton();
            }
        }
        
        function selectTasbihType(type) {
            currentTasbihType = type;
            
            // تحديث الأزرار النشطة
            document.querySelectorAll('.tasbih-preset').forEach(preset => {
                preset.classList.remove('active');
            });
            event.target.closest('.tasbih-preset').classList.add('active');
            
            // تحديث النص المعروض
            const texts = {
                'subhanallah': 'سبحان الله',
                'alhamdulillah': 'الحمد لله',
                'allahuakbar': 'الله أكبر',
                'laillaha': 'لا إله إلا الله'
            };
            document.getElementById('currentTasbih').textContent = texts[type];
            
            // تشغيل صوت التسبيح
            if (tasbihSoundEnabled) {
                playTasbihSound();
            }
            
            // إعادة تعيين العداد
            resetTasbih();
            
            showNotification('تم التغيير', `تم اختيار ${texts[type]}`);
        }
        
        function incrementTasbih() {
            tasbihCount++;
            updateCounter();
            
            // تشغيل صوت التسبيح
            if (tasbihSoundEnabled) {
                playTasbihSound();
            }
            
            // الاحتفال عند الوصول إلى أرقام محددة
            celebrateMilestones();
            
            // تحديث تحديات المسبحة
            updateTasbihChallenge();
            
            // إضافة إلى السجل
            addToHistory();
        }
        
        function changeTasbih(amount) {
            tasbihCount += amount;
            if (tasbihCount < 0) tasbihCount = 0;
            updateCounter();
            
            if (amount > 0) {
                updateTasbihChallenge();
                addToHistory();
            }
        }
        
        function setTasbih(value) {
            tasbihCount = value;
            updateCounter();
            
            if (value > 0) {
                updateTasbihChallenge();
                addToHistory();
            }
            
            showNotification('تم الضبط', `تم ضبط العداد على ${value}`);
        }
        
        function resetTasbih() {
            tasbihCount = 0;
            updateCounter();
            showNotification('إعادة تعيين', 'تم إعادة تعيين المسبحة');
        }
        
        function updateCounter() {
            const counter = document.getElementById('counter');
            counter.textContent = tasbihCount;
            
            // تأثيرات بصرية
            counter.classList.add('celebrate');
            setTimeout(() => {
                counter.classList.remove('celebrate');
            }, 500);
        }
        
        function celebrateMilestones() {
            const milestones = [33, 100, 500, 1000];
            
            if (milestones.includes(tasbihCount)) {
                // تشغيل الألعاب النارية
                createFireworks();
                
                // عرض إشعار
                showNotification('مبارك!', `لقد أتممت ${tasbihCount} تسبيحة!`);
                
                // تحديث التحديات
                if (tasbihCount === 33) {
                    completeChallenge('tasbih_33', 50);
                } else if (tasbihCount === 100) {
                    completeChallenge('tasbih_100', 100);
                }
            }
        }
        
        function toggleTasbihSound() {
            tasbihSoundEnabled = !tasbihSoundEnabled;
            localStorage.setItem('tasbihSound', tasbihSoundEnabled.toString());
            updateSoundButton();
            
            showNotification('الصوت', `تم ${tasbihSoundEnabled ? 'تفعيل' : 'إيقاف'} صوت التسبيح`);
        }
        
        function updateSoundButton() {
            const btn = document.getElementById('soundBtn');
            const status = document.getElementById('soundStatus');
            
            if (tasbihSoundEnabled) {
                btn.innerHTML = '<i class="fas fa-volume-up"></i> صوت التسبيح: <span id="soundStatus">مفعل</span>';
                status.textContent = 'مفعل';
            } else {
                btn.innerHTML = '<i class="fas fa-volume-mute"></i> صوت التسبيح: <span id="soundStatus">معطل</span>';
                status.textContent = 'معطل';
            }
        }
        
        function playTasbihSound() {
            // إنشاء صوت تسبيح بسيط
            const audioContext = new (window.AudioContext || window.webkitAudioContext)();
            const oscillator = audioContext.createOscillator();
            const gainNode = audioContext.createGain();
            
            oscillator.connect(gainNode);
            gainNode.connect(audioContext.destination);
            
            oscillator.frequency.value = 440; // تردد A4
            oscillator.type = 'sine';
            
            gainNode.gain.setValueAtTime(0.1, audioContext.currentTime);
            gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.1);
            
            oscillator.start(audioContext.currentTime);
            oscillator.stop(audioContext.currentTime + 0.1);
        }
        
        function saveTasbihSession() {
            const session = {
                type: currentTasbihType,
                count: tasbihCount,
                timestamp: new Date().toISOString(),
                date: new Date().toLocaleDateString('ar-SA')
            };
            
            const sessions = JSON.parse(localStorage.getItem('tasbihSessions') || '[]');
            sessions.push(session);
            localStorage.setItem('tasbihSessions', JSON.stringify(sessions));
            
            showNotification('تم الحفظ', 'تم حفظ جلسة التسبيح');
        }
        
        function addToHistory() {
            const entry = {
                type: currentTasbihType,
                count: 1,
                timestamp: new Date().toLocaleTimeString('ar-SA')
            };
            
            tasbihHistory.unshift(entry);
            if (tasbihHistory.length > 50) {
                tasbihHistory.pop();
            }
            
            localStorage.setItem('tasbihHistory', JSON.stringify(tasbihHistory));
            updateHistoryDisplay();
        }
        
        function loadTasbihHistory() {
            const saved = localStorage.getItem('tasbihHistory');
            if (saved) {
                tasbihHistory = JSON.parse(saved);
            }
        }
        
        function showTasbihHistory() {
            const historyDiv = document.getElementById('tasbihHistory');
            historyDiv.style.display = historyDiv.style.display === 'none' ? 'block' : 'none';
            
            if (historyDiv.style.display === 'block') {
                updateHistoryDisplay();
            }
        }
        
        function updateHistoryDisplay() {
            const list = document.getElementById('historyList');
            list.innerHTML = '';
            
            const today = new Date().toLocaleDateString('ar-SA');
            const todayHistory = tasbihHistory.filter(entry => 
                new Date(entry.timestamp).toLocaleDateString('ar-SA') === today
            );
            
            if (todayHistory.length === 0) {
                list.innerHTML = '<div style="color: #aaa; text-align: center; padding: 20px;">لا توجد تسبيحات اليوم</div>';
                return;
            }
            
            todayHistory.forEach(entry => {
                const item = document.createElement('div');
                item.className = 'history-item';
                item.innerHTML = `
                    <div>${getTasbihTypeText(entry.type)}</div>
                    <div style="color: var(--gold);">${entry.timestamp}</div>
                `;
                list.appendChild(item);
            });
        }
        
        function getTasbihTypeText(type) {
            const texts = {
                'subhanallah': 'سبحان الله',
                'alhamdulillah': 'الحمد لله',
                'allahuakbar': 'الله أكبر',
                'laillaha': 'لا إله إلا الله'
            };
            return texts[type] || type;
        }
        
        function startDailyChallenge() {
            setTasbih(33);
            showNotification('تحدي اليوم', 'ابدأ بـ 33 تسبيحة!');
        }
        
        function updateTasbihChallenge() {
            const challengeId = 'daily_tasbih';
            updateChallengeProgress(challengeId, 1);
        }
        
        // ==================== نظام التخصيص ====================
        let currentTheme = 'gold';
        let currentFont = 'lateef';
        let currentBackground = 'none';
        
        function initCustomization() {
            // تحميل الإعدادات المحفوظة
            const savedTheme = localStorage.getItem('theme');
            const savedFont = localStorage.getItem('quranFont');
            const savedBackground = localStorage.getItem('background');
            
            if (savedTheme) {
                selectTheme(savedTheme, false);
            }
            if (savedFont) {
                selectFont(savedFont, false);
            }
            if (savedBackground) {
                selectBackground(savedBackground, false);
            }
        }
        
        function selectTheme(theme, showNotification = true) {
            currentTheme = theme;
            
            // تحديث الفئات النشطة
            document.querySelectorAll('.theme-card').forEach(card => {
                card.classList.remove('active');
            });
            event?.target.closest('.theme-card').classList.add('active');
            
            // تغيير سمة الصفحة
            document.body.className = `theme-${theme}`;
            
            // حفظ الإعدادات
            localStorage.setItem('theme', theme);
            
            if (showNotification) {
                showNotification('تم التغيير', `تم تطبيق السمة ${theme}`);
            }
        }
        
        function selectFont(font, showNotification = true) {
            currentFont = font;
            
            // تحديث الفئات النشطة
            document.querySelectorAll('.font-option').forEach(option => {
                option.classList.remove('active');
                option.querySelector('i').style.color = 'transparent';
            });
            
            const selectedOption = event?.target.closest('.font-option') || 
                                 document.querySelector(`.font-option[onclick*="${font}"]`);
            if (selectedOption) {
                selectedOption.classList.add('active');
                selectedOption.querySelector('i').style.color = 'var(--gold)';
            }
            
            // حفظ الإعدادات
            localStorage.setItem('quranFont', font);
            
            if (showNotification) {
                showNotification('تم التغيير', `تم تغيير خط القرآن`);
            }
        }
        
        function selectBackground(background, showNotification = true) {
            currentBackground = background;
            
            // تحديث الفئات النشطة
            document.querySelectorAll('.background-option').forEach(option => {
                option.classList.remove('active');
            });
            
            const selectedOption = event?.target.closest('.background-option') || 
                                 document.querySelector(`.background-option[onclick*="${background}"]`);
            if (selectedOption) {
                selectedOption.classList.add('active');
            }
            
            // تطبيق الخلفية
            if (background === 'none') {
                document.body.style.backgroundImage = '';
            } else {
                // استخدام خلفيات افتراضية (في التطبيق الحقيقي ستكون هناك صور حقيقية)
                const backgrounds = {
                    'mosque': 'linear-gradient(rgba(0,0,0,0.7), rgba(0,0,0,0.7)), url(https://images.unsplash.com/photo-1562774053-701939374585?ixlib=rb-1.2.1&auto=format&fit=crop&w=500&q=60)',
                    'pattern': 'linear-gradient(rgba(0,0,0,0.7), rgba(0,0,0,0.7)), url(https://images.unsplash.com/photo-1544914379-8066678f8c75?ixlib=rb-1.2.1&auto=format&fit=crop&w=500&q=60)',
                    'texture': 'linear-gradient(rgba(0,0,0,0.7), rgba(0,0,0,0.7)), url(https://images.unsplash.com/photo-1506905925346-21bda4d32df4?ixlib=rb-1.2.1&auto=format&fit=crop&w=500&q=60)'
                };
                
                document.body.style.backgroundImage = backgrounds[background] || '';
                document.body.style.backgroundSize = 'cover';
                document.body.style.backgroundAttachment = 'fixed';
                document.body.style.backgroundPosition = 'center';
            }
            
            // حفظ الإعدادات
            localStorage.setItem('background', background);
            
            if (showNotification) {
                showNotification('تم التغيير', `تم تغيير الخلفية`);
            }
        }
        
        function resetCustomization() {
            selectTheme('gold', false);
            selectFont('lateef', false);
            selectBackground('none', false);
            
            showNotification('تم الإعادة', 'تمت إعادة التعيين للوضع الافتراضي');
        }
        
        function saveCustomization() {
            // الإعدادات محفوظة تلقائياً
            showNotification('تم الحفظ', 'تم حفظ إعدادات التخصيص');
        }
        
        // ==================== وظائف مساعدة ====================
        function showSection(id) {
            // إخفاء جميع الأقسام
            document.querySelectorAll('.section').forEach(s => {
                s.classList.remove('active-section');
            });
            
            // تحديث الأزرار النشطة
            document.querySelectorAll('nav button').forEach(b => {
                b.classList.remove('active');
            });
            
            document.querySelectorAll('.footer-btn').forEach(b => {
                b.classList.remove('active');
            });
            
            // إظهار القسم المحدد
            document.getElementById(id).classList.add('active-section');
            document.getElementById(`m-${id}`)?.classList.add('active');
            
            const footerBtn = document.querySelector(`.footer-btn[onclick="showSection('${id}')"]`);
            if (footerBtn) {
                footerBtn.classList.add('active');
            }
            
            // إجراءات خاصة بكل قسم
            switch(id) {
                case 'quran':
                    initQuran();
                    break;
                case 'azkar':
                    checkAzkarTime();
                    break;
                case 'tasbih':
                    // لا شيء
                    break;
                case 'theme':
                    // لا شيء
                    break;
            }
        }
        
        function showNotification(title, message) {
            // إنشاء إشعار
            const notification = document.createElement('div');
            notification.className = 'notification';
            notification.innerHTML = `
                <div style="display: flex; align-items: center; gap: 10px;">
                    <i class="fas fa-info-circle" style="color: var(--gold);"></i>
                    <div>
                        <strong>${title}</strong><br>
                        <span style="color: #aaa;">${message}</span>
                    </div>
                </div>
            `;
            
            document.body.appendChild(notification);
            
            // إخفاء الإشعار بعد 3 ثوانٍ
            setTimeout(() => {
                notification.style.animation = 'slideOut 0.3s ease';
                setTimeout(() => {
                    notification.remove();
                }, 300);
            }, 3000);
        }
        
        function createFireworks() {
            const container = document.getElementById('fireworks');
            container.innerHTML = '';
            container.style.display = 'block';
            
            for (let i = 0; i < 15; i++) {
                const firework = document.createElement('div');
                firework.style.cssText = `
                    position: fixed;
                    width: 5px;
                    height: 5px;
                    background: ${getRandomColor()};
                    border-radius: 50%;
                    animation: explode 1s ease-out;
                    left: ${Math.random() * 100}%;
                    top: ${Math.random() * 100}%;
                    z-index: 9999;
                    pointer-events: none;
                `;
                
                document.body.appendChild(firework);
                
                setTimeout(() => {
                    firework.remove();
                }, 1000);
            }
            
            setTimeout(() => {
                container.style.display = 'none';
            }, 1100);
        }
        
        function getRandomColor() {
            const colors = ['#FFD700', '#FF6B6B', '#4ECDC4', '#45B7D1', '#96CEB4', '#FFEAA7'];
            return colors[Math.floor(Math.random() * colors.length)];
        }
        
        // إضافة أنماط CSS للرسوم المتحركة
        const style = document.createElement('style');
        style.textContent = `
            @keyframes pulse {
                0% { transform: scale(1); opacity: 1; }
                50% { transform: scale(1.1); opacity: 0.8; }
                100% { transform: scale(1); opacity: 1; }
            }
            @keyframes explode {
                0% { transform: scale(1); opacity: 1; }
                100% { transform: scale(20); opacity: 0; }
            }
        `;
        document.head.appendChild(style);
    </script>
</body>
</html>